<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) | Jeanphilo Blog</title>
<meta name="keywords" content="CrowdSec, UFW, Fail2ban, FRP, port-scan, server-security">
<meta name="description" content="UFW &#43; CrowdSec: Stop Malicious Port Scans
Subtitle / Abstract: How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.

Target readers

Developers using FRP or reverse tunnels
Operators of cloud servers (Tencent, Alibaba, AWS, etc.)
Linux users who want to stop port scans and SSH brute force
People using Fail2ban who want a modern alternative
Anyone improving personal server security


Background / Motivation: Why you need port-scan defense
When you run FRP (frps &#43; frpc) or expose multiple ports, you will often see:">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/en/linux/linux/ufw-crowdsec-portscan/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/linux/linux/ufw-crowdsec-portscan/">
<link rel="alternate" hreflang="en" href="http://localhost:1313/en/linux/linux/ufw-crowdsec-portscan/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/en/linux/linux/ufw-crowdsec-portscan/">
  <meta property="og:site_name" content="Jeanphilo Blog">
  <meta property="og:title" content="UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)">
  <meta property="og:description" content="UFW &#43; CrowdSec: Stop Malicious Port Scans Subtitle / Abstract: How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.
Target readers Developers using FRP or reverse tunnels Operators of cloud servers (Tencent, Alibaba, AWS, etc.) Linux users who want to stop port scans and SSH brute force People using Fail2ban who want a modern alternative Anyone improving personal server security Background / Motivation: Why you need port-scan defense When you run FRP (frps &#43; frpc) or expose multiple ports, you will often see:">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="linux">
    <meta property="article:published_time" content="2025-11-22T12:00:00+08:00">
    <meta property="article:modified_time" content="2025-11-22T12:00:00+08:00">
    <meta property="article:tag" content="CrowdSec">
    <meta property="article:tag" content="UFW">
    <meta property="article:tag" content="Fail2ban">
    <meta property="article:tag" content="FRP">
    <meta property="article:tag" content="Port-Scan">
    <meta property="article:tag" content="Server-Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)">
<meta name="twitter:description" content="UFW &#43; CrowdSec: Stop Malicious Port Scans
Subtitle / Abstract: How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.

Target readers

Developers using FRP or reverse tunnels
Operators of cloud servers (Tencent, Alibaba, AWS, etc.)
Linux users who want to stop port scans and SSH brute force
People using Fail2ban who want a modern alternative
Anyone improving personal server security


Background / Motivation: Why you need port-scan defense
When you run FRP (frps &#43; frpc) or expose multiple ports, you will often see:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Linux",
      "item": "http://localhost:1313/en/linux/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Linux",
      "item": "http://localhost:1313/en/linux/linux/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "UFW + CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)",
      "item": "http://localhost:1313/en/linux/linux/ufw-crowdsec-portscan/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "UFW + CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)",
  "name": "UFW \u002b CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)",
  "description": "UFW + CrowdSec: Stop Malicious Port Scans Subtitle / Abstract: How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.\nTarget readers Developers using FRP or reverse tunnels Operators of cloud servers (Tencent, Alibaba, AWS, etc.) Linux users who want to stop port scans and SSH brute force People using Fail2ban who want a modern alternative Anyone improving personal server security Background / Motivation: Why you need port-scan defense When you run FRP (frps + frpc) or expose multiple ports, you will often see:\n",
  "keywords": [
    "CrowdSec", "UFW", "Fail2ban", "FRP", "port-scan", "server-security"
  ],
  "articleBody": "UFW + CrowdSec: Stop Malicious Port Scans Subtitle / Abstract: How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.\nTarget readers Developers using FRP or reverse tunnels Operators of cloud servers (Tencent, Alibaba, AWS, etc.) Linux users who want to stop port scans and SSH brute force People using Fail2ban who want a modern alternative Anyone improving personal server security Background / Motivation: Why you need port-scan defense When you run FRP (frps + frpc) or expose multiple ports, you will often see:\nMassive scans: repeated SYN probes Malicious connection attempts SSH password brute force Automated scans of 6001-6010, 7000, 22, 8080, etc. Traditional approaches have weaknesses:\nUFW only blocks passively Fail2ban is regex-heavy, error-prone, and lacks behavior analysis FRPS logs are hard to match in Fail2ban Attacks still consume frps/sshd resources and can cause slowdowns We need a modern system: no regex, auto detection, intelligent IP banning.\nCore concepts FRP (frps / frpc): reverse tunnel tool, often exposes many TCP ports (e.g., 6001-6010) UFW: Ubuntu firewall, but not intelligent Fail2ban: log-matching ban tool that requires regex CrowdSec (recommended): modern open-source IPS that detects port scans and brute force with behavior analysis and low resource usage Practical guide: Auto-block port scans with CrowdSec (Ubuntu/Debian) 1) Install CrowdSec curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash sudo apt install crowdsec -y 2) Install firewall bouncer (iptables/UFW) sudo apt install crowdsec-firewall-bouncer-iptables CrowdSec will manage blocking automatically.\n3) What it detects out of the box TCP port scans FRP brute-force attempts SSH brute force High-rate connections (DoS-like) Suspicious sequences (behavior analysis) No extra rules needed for 6001-6010 and other ports.\n4) View banned IPs sudo cscli decisions list Example:\nID Scope Value Reason Duration 1 Ip 195.24.237.176 portscan 4h 2 Ip 213.199.63.251 ssh-bf 24h 5) Manual ban (optional) sudo cscli decisions add --ip 195.24.237.176 6) Dashboard (optional) sudo apt install crowdsec-lapi Why CrowdSec \u003e Fail2ban Feature Fail2ban CrowdSec Port-scan detection No Yes (auto) FRP log support Regex heavy No log match needed Config complexity High Low Performance Medium Very low Extensibility Weak Modular + behavior analysis Visualization None Dashboard Resource usage Medium RAM \u003c 20MB CrowdSec is a modern replacement for Fail2ban with lower overhead and stronger detection.\nFail2ban pitfalls (why it fails in FRP scenarios) FRPS logs are complex; IP fields shift and are inconsistent Regex must be perfect; a small mistake matches nothing Logs include colons, brackets, and ports, which break patterns Host IP may be internal (e.g., 10.5.100.2), causing mismatched source IPs UFW log formats vary; Fail2ban cannot extract IP reliably Encoding issues can lead to “No failure-id group” Risks and notes Blocking can briefly impact FRP or SSH; always keep a backup access method (cloud console). CrowdSec may false-positive crawlers. Whitelist trusted IPs: sudo cscli machines list sudo cscli decisions delete --ip FRP often hides real client IPs in logs; CrowdSec works at the kernel level, so it still sees the source. Best practices Replace Fail2ban with CrowdSec (strongly recommended) Close unused FRP ports, use strong tokens and encryption Use SSH keys only, disable password auth Keep UFW default deny incoming Check bans regularly: cscli decisions list Consider Cloudflare Tunnel as an alternative to FRP Summary This guide covered:\nHow to detect and block port scans Why Fail2ban regex often fails Why FRP logs are a poor fit for Fail2ban How CrowdSec provides automated, low-maintenance protection Final solution: UFW + CrowdSec = stable, automated, low-maintenance server defense.\nReferences CrowdSec docs: https://doc.crowdsec.net CrowdSec bouncer: https://github.com/crowdsecurity/cs-firewall-bouncer Fail2ban docs: https://fail2ban.readthedocs.io FRP: https://github.com/fatedier/frp UFW docs: https://wiki.ubuntu.com/UFW ",
  "wordCount" : "599",
  "inLanguage": "en",
  "datePublished": "2025-11-22T12:00:00+08:00",
  "dateModified": "2025-11-22T12:00:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/en/linux/linux/ufw-crowdsec-portscan/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jeanphilo Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/en/" accesskey="h" title="Jeanphilo Blog (Alt + H)">Jeanphilo Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/" title="中文"
                                aria-label="中文">Zh</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/en/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/en/dev/" title="Development">
                    <span>Dev</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/en/alg/" title="Algorithms">
                    <span>Algorithms</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/en/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/en/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/en/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/en/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/en/linux/">Linux</a>&nbsp;»&nbsp;<a href="http://localhost:1313/en/linux/linux/">Linux</a></div>
    <h1 class="post-title entry-hint-parent">
      UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution)
    </h1>
    <div class="post-meta"><span title='2025-11-22 12:00:00 +0800 HKT'>November 22, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;|&nbsp;<span>Translations:</span>
<ul class="i18n_list">
    <li>
        <a href="http://localhost:1313/linux/linux/ufw-crowdsec-portscan/">Zh</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#ufw--crowdsec-stop-malicious-port-scans" aria-label="UFW &#43; CrowdSec: Stop Malicious Port Scans">UFW + CrowdSec: Stop Malicious Port Scans</a><ul>
                        
                <li>
                    <a href="#target-readers" aria-label="Target readers">Target readers</a></li>
                <li>
                    <a href="#background--motivation-why-you-need-port-scan-defense" aria-label="Background / Motivation: Why you need port-scan defense">Background / Motivation: Why you need port-scan defense</a></li>
                <li>
                    <a href="#core-concepts" aria-label="Core concepts">Core concepts</a></li>
                <li>
                    <a href="#practical-guide-auto-block-port-scans-with-crowdsec-ubuntudebian" aria-label="Practical guide: Auto-block port scans with CrowdSec (Ubuntu/Debian)">Practical guide: Auto-block port scans with CrowdSec (Ubuntu/Debian)</a><ul>
                        
                <li>
                    <a href="#1-install-crowdsec" aria-label="1) Install CrowdSec">1) Install CrowdSec</a></li>
                <li>
                    <a href="#2-install-firewall-bouncer-iptablesufw" aria-label="2) Install firewall bouncer (iptables/UFW)">2) Install firewall bouncer (iptables/UFW)</a></li>
                <li>
                    <a href="#3-what-it-detects-out-of-the-box" aria-label="3) What it detects out of the box">3) What it detects out of the box</a></li>
                <li>
                    <a href="#4-view-banned-ips" aria-label="4) View banned IPs">4) View banned IPs</a></li>
                <li>
                    <a href="#5-manual-ban-optional" aria-label="5) Manual ban (optional)">5) Manual ban (optional)</a></li>
                <li>
                    <a href="#6-dashboard-optional" aria-label="6) Dashboard (optional)">6) Dashboard (optional)</a></li></ul>
                </li>
                <li>
                    <a href="#why-crowdsec--fail2ban" aria-label="Why CrowdSec &gt; Fail2ban">Why CrowdSec &gt; Fail2ban</a></li>
                <li>
                    <a href="#fail2ban-pitfalls-why-it-fails-in-frp-scenarios" aria-label="Fail2ban pitfalls (why it fails in FRP scenarios)">Fail2ban pitfalls (why it fails in FRP scenarios)</a></li>
                <li>
                    <a href="#risks-and-notes" aria-label="Risks and notes">Risks and notes</a></li>
                <li>
                    <a href="#best-practices" aria-label="Best practices">Best practices</a></li>
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="ufw--crowdsec-stop-malicious-port-scans">UFW + CrowdSec: Stop Malicious Port Scans<a hidden class="anchor" aria-hidden="true" href="#ufw--crowdsec-stop-malicious-port-scans">#</a></h1>
<p><strong>Subtitle / Abstract:</strong> How do you protect exposed server ports? This guide shows how to move past Fail2ban regex hell and build a stable, automated, intelligent port-scan defense system.</p>
<hr>
<h2 id="target-readers">Target readers<a hidden class="anchor" aria-hidden="true" href="#target-readers">#</a></h2>
<ul>
<li>Developers using FRP or reverse tunnels</li>
<li>Operators of cloud servers (Tencent, Alibaba, AWS, etc.)</li>
<li>Linux users who want to stop port scans and SSH brute force</li>
<li>People using Fail2ban who want a modern alternative</li>
<li>Anyone improving personal server security</li>
</ul>
<hr>
<h2 id="background--motivation-why-you-need-port-scan-defense">Background / Motivation: Why you need port-scan defense<a hidden class="anchor" aria-hidden="true" href="#background--motivation-why-you-need-port-scan-defense">#</a></h2>
<p>When you run FRP (frps + frpc) or expose multiple ports, you will often see:</p>
<ul>
<li>Massive scans: repeated SYN probes</li>
<li>Malicious connection attempts</li>
<li>SSH password brute force</li>
<li>Automated scans of 6001-6010, 7000, 22, 8080, etc.</li>
</ul>
<p>Traditional approaches have weaknesses:</p>
<ul>
<li>UFW only blocks passively</li>
<li>Fail2ban is regex-heavy, error-prone, and lacks behavior analysis</li>
<li>FRPS logs are hard to match in Fail2ban</li>
<li>Attacks still consume frps/sshd resources and can cause slowdowns</li>
</ul>
<p>We need a modern system: <strong>no regex, auto detection, intelligent IP banning</strong>.</p>
<hr>
<h2 id="core-concepts">Core concepts<a hidden class="anchor" aria-hidden="true" href="#core-concepts">#</a></h2>
<ul>
<li><strong>FRP (frps / frpc)</strong>: reverse tunnel tool, often exposes many TCP ports (e.g., 6001-6010)</li>
<li><strong>UFW</strong>: Ubuntu firewall, but not intelligent</li>
<li><strong>Fail2ban</strong>: log-matching ban tool that requires regex</li>
<li><strong>CrowdSec (recommended)</strong>: modern open-source IPS that detects port scans and brute force with behavior analysis and low resource usage</li>
</ul>
<hr>
<h2 id="practical-guide-auto-block-port-scans-with-crowdsec-ubuntudebian">Practical guide: Auto-block port scans with CrowdSec (Ubuntu/Debian)<a hidden class="anchor" aria-hidden="true" href="#practical-guide-auto-block-port-scans-with-crowdsec-ubuntudebian">#</a></h2>
<h3 id="1-install-crowdsec">1) Install CrowdSec<a hidden class="anchor" aria-hidden="true" href="#1-install-crowdsec">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash
</span></span><span style="display:flex;"><span>sudo apt install crowdsec -y
</span></span></code></pre></div><h3 id="2-install-firewall-bouncer-iptablesufw">2) Install firewall bouncer (iptables/UFW)<a hidden class="anchor" aria-hidden="true" href="#2-install-firewall-bouncer-iptablesufw">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install crowdsec-firewall-bouncer-iptables
</span></span></code></pre></div><p>CrowdSec will manage blocking automatically.</p>
<h3 id="3-what-it-detects-out-of-the-box">3) What it detects out of the box<a hidden class="anchor" aria-hidden="true" href="#3-what-it-detects-out-of-the-box">#</a></h3>
<ul>
<li>TCP port scans</li>
<li>FRP brute-force attempts</li>
<li>SSH brute force</li>
<li>High-rate connections (DoS-like)</li>
<li>Suspicious sequences (behavior analysis)</li>
</ul>
<p>No extra rules needed for 6001-6010 and other ports.</p>
<h3 id="4-view-banned-ips">4) View banned IPs<a hidden class="anchor" aria-hidden="true" href="#4-view-banned-ips">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cscli decisions list
</span></span></code></pre></div><p>Example:</p>
<pre tabindex="0"><code>ID   Scope   Value             Reason    Duration
1    Ip      195.24.237.176    portscan  4h
2    Ip      213.199.63.251    ssh-bf    24h
</code></pre><h3 id="5-manual-ban-optional">5) Manual ban (optional)<a hidden class="anchor" aria-hidden="true" href="#5-manual-ban-optional">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cscli decisions add --ip 195.24.237.176
</span></span></code></pre></div><h3 id="6-dashboard-optional">6) Dashboard (optional)<a hidden class="anchor" aria-hidden="true" href="#6-dashboard-optional">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install crowdsec-lapi
</span></span></code></pre></div><hr>
<h2 id="why-crowdsec--fail2ban">Why CrowdSec &gt; Fail2ban<a hidden class="anchor" aria-hidden="true" href="#why-crowdsec--fail2ban">#</a></h2>
<table>
  <thead>
      <tr>
          <th>Feature</th>
          <th>Fail2ban</th>
          <th>CrowdSec</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Port-scan detection</td>
          <td>No</td>
          <td>Yes (auto)</td>
      </tr>
      <tr>
          <td>FRP log support</td>
          <td>Regex heavy</td>
          <td>No log match needed</td>
      </tr>
      <tr>
          <td>Config complexity</td>
          <td>High</td>
          <td>Low</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Medium</td>
          <td>Very low</td>
      </tr>
      <tr>
          <td>Extensibility</td>
          <td>Weak</td>
          <td>Modular + behavior analysis</td>
      </tr>
      <tr>
          <td>Visualization</td>
          <td>None</td>
          <td>Dashboard</td>
      </tr>
      <tr>
          <td>Resource usage</td>
          <td>Medium</td>
          <td>RAM &lt; 20MB</td>
      </tr>
  </tbody>
</table>
<p>CrowdSec is a modern replacement for Fail2ban with lower overhead and stronger detection.</p>
<hr>
<h2 id="fail2ban-pitfalls-why-it-fails-in-frp-scenarios">Fail2ban pitfalls (why it fails in FRP scenarios)<a hidden class="anchor" aria-hidden="true" href="#fail2ban-pitfalls-why-it-fails-in-frp-scenarios">#</a></h2>
<ul>
<li>FRPS logs are complex; IP fields shift and are inconsistent</li>
<li>Regex must be perfect; a small mistake matches nothing</li>
<li>Logs include colons, brackets, and ports, which break patterns</li>
<li>Host IP may be internal (e.g., 10.5.100.2), causing mismatched source IPs</li>
<li>UFW log formats vary; Fail2ban cannot extract IP reliably</li>
<li>Encoding issues can lead to &ldquo;No failure-id group&rdquo;</li>
</ul>
<hr>
<h2 id="risks-and-notes">Risks and notes<a hidden class="anchor" aria-hidden="true" href="#risks-and-notes">#</a></h2>
<ol>
<li>Blocking can briefly impact FRP or SSH; always keep a backup access method (cloud console).</li>
<li>CrowdSec may false-positive crawlers. Whitelist trusted IPs:
<ul>
<li><code>sudo cscli machines list</code></li>
<li><code>sudo cscli decisions delete --ip &lt;trusted-ip&gt;</code></li>
</ul>
</li>
<li>FRP often hides real client IPs in logs; CrowdSec works at the kernel level, so it still sees the source.</li>
</ol>
<hr>
<h2 id="best-practices">Best practices<a hidden class="anchor" aria-hidden="true" href="#best-practices">#</a></h2>
<ul>
<li>Replace Fail2ban with CrowdSec (strongly recommended)</li>
<li>Close unused FRP ports, use strong tokens and encryption</li>
<li>Use SSH keys only, disable password auth</li>
<li>Keep UFW default deny incoming</li>
<li>Check bans regularly: <code>cscli decisions list</code></li>
<li>Consider Cloudflare Tunnel as an alternative to FRP</li>
</ul>
<hr>
<h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>This guide covered:</p>
<ul>
<li>How to detect and block port scans</li>
<li>Why Fail2ban regex often fails</li>
<li>Why FRP logs are a poor fit for Fail2ban</li>
<li>How CrowdSec provides automated, low-maintenance protection</li>
</ul>
<p><strong>Final solution: UFW + CrowdSec = stable, automated, low-maintenance server defense.</strong></p>
<hr>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li>CrowdSec docs: <a href="https://doc.crowdsec.net">https://doc.crowdsec.net</a></li>
<li>CrowdSec bouncer: <a href="https://github.com/crowdsecurity/cs-firewall-bouncer">https://github.com/crowdsecurity/cs-firewall-bouncer</a></li>
<li>Fail2ban docs: <a href="https://fail2ban.readthedocs.io">https://fail2ban.readthedocs.io</a></li>
<li>FRP: <a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></li>
<li>UFW docs: <a href="https://wiki.ubuntu.com/UFW">https://wiki.ubuntu.com/UFW</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/en/tags/crowdsec/">CrowdSec</a></li>
      <li><a href="http://localhost:1313/en/tags/ufw/">UFW</a></li>
      <li><a href="http://localhost:1313/en/tags/fail2ban/">Fail2ban</a></li>
      <li><a href="http://localhost:1313/en/tags/frp/">FRP</a></li>
      <li><a href="http://localhost:1313/en/tags/port-scan/">Port-Scan</a></li>
      <li><a href="http://localhost:1313/en/tags/server-security/">Server-Security</a></li>
    </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on x"
            href="https://x.com/intent/tweet/?text=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29&amp;url=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f&amp;hashtags=CrowdSec%2cUFW%2cFail2ban%2cFRP%2cport-scan%2cserver-security">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f&amp;title=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29&amp;summary=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29&amp;source=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f&title=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on whatsapp"
            href="https://api.whatsapp.com/send?text=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29%20-%20http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on telegram"
            href="https://telegram.me/share/url?text=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29&amp;url=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share UFW &#43; CrowdSec: Stop Malicious Port Scans (From Fail2ban Pain to a Modern Solution) on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=UFW%20%2b%20CrowdSec%3a%20Stop%20Malicious%20Port%20Scans%20%28From%20Fail2ban%20Pain%20to%20a%20Modern%20Solution%29&u=http%3a%2f%2flocalhost%3a1313%2fen%2flinux%2flinux%2fufw-crowdsec-portscan%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/en/">Jeanphilo Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

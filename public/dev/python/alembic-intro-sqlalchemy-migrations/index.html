<!DOCTYPE html>
<html lang="zh" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» | Jeanphilo Blog</title>
<meta name="keywords" content="">
<meta name="description" content="ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»
ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦
å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ &#43; å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚
æˆ‘ä»¬ä¼šä» 0 é…ç½® Alembic å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚

ğŸ¯ ç›®æ ‡è¯»è€…
é€‚åˆè¿™æ ·çš„ä½ ï¼š

å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ SQLAlchemyï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼›
ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ alembic upgrade head è¿™å‡ ä¸ªå‘½ä»¤ï¼›
æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡ çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼›
ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚


ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ
æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ

åœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼›
å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼›
ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼›
ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚

å¸¸è§ç—›ç‚¹ï¼š

å¤šäººåä½œå›°éš¾ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ
ç¯å¢ƒä¸ä¸€è‡´ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼›
éš¾ä»¥å›æ»šï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼›
å®¡è®¡å›°éš¾ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚

Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/dev/python/alembic-intro-sqlalchemy-migrations/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/dev/python/alembic-intro-sqlalchemy-migrations/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/dev/python/alembic-intro-sqlalchemy-migrations/">
  <meta property="og:site_name" content="Jeanphilo Blog">
  <meta property="og:title" content="Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»">
  <meta property="og:description" content="ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦ å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ &#43; å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚
æˆ‘ä»¬ä¼šä» 0 é…ç½® Alembic å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚
ğŸ¯ ç›®æ ‡è¯»è€… é€‚åˆè¿™æ ·çš„ä½ ï¼š
å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ SQLAlchemyï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼› ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ alembic upgrade head è¿™å‡ ä¸ªå‘½ä»¤ï¼› æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡ çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼› ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚ ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ
åœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼› å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼› ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼› ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚ å¸¸è§ç—›ç‚¹ï¼š
å¤šäººåä½œå›°éš¾ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ ç¯å¢ƒä¸ä¸€è‡´ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼› éš¾ä»¥å›æ»šï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼› å®¡è®¡å›°éš¾ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚ Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="dev">
    <meta property="article:published_time" content="2025-11-28T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-28T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»">
<meta name="twitter:description" content="ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»
ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦
å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ &#43; å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚
æˆ‘ä»¬ä¼šä» 0 é…ç½® Alembic å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚

ğŸ¯ ç›®æ ‡è¯»è€…
é€‚åˆè¿™æ ·çš„ä½ ï¼š

å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ SQLAlchemyï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼›
ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ alembic upgrade head è¿™å‡ ä¸ªå‘½ä»¤ï¼›
æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡ çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼›
ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚


ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ
æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ

åœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼›
å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼›
ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼›
ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚

å¸¸è§ç—›ç‚¹ï¼š

å¤šäººåä½œå›°éš¾ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ
ç¯å¢ƒä¸ä¸€è‡´ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼›
éš¾ä»¥å›æ»šï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼›
å®¡è®¡å›°éš¾ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚

Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "å¼€å‘",
      "item": "http://localhost:1313/dev/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Python",
      "item": "http://localhost:1313/dev/python/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»",
      "item": "http://localhost:1313/dev/python/alembic-intro-sqlalchemy-migrations/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»",
  "name": "Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»",
  "description": "ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦ å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ + å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚\næˆ‘ä»¬ä¼šä» 0 é…ç½® Alembic å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚\nğŸ¯ ç›®æ ‡è¯»è€… é€‚åˆè¿™æ ·çš„ä½ ï¼š\nå·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ SQLAlchemyï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼› ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ alembic upgrade head è¿™å‡ ä¸ªå‘½ä»¤ï¼› æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡ çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼› ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚ ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ\nåœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼› å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼› ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼› ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚ å¸¸è§ç—›ç‚¹ï¼š\nå¤šäººåä½œå›°éš¾ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ ç¯å¢ƒä¸ä¸€è‡´ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼› éš¾ä»¥å›æ»šï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼› å®¡è®¡å›°éš¾ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚ Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š\n",
  "keywords": [
    
  ],
  "articleBody": "ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦ å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ + å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚\næˆ‘ä»¬ä¼šä» 0 é…ç½® Alembic å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚\nğŸ¯ ç›®æ ‡è¯»è€… é€‚åˆè¿™æ ·çš„ä½ ï¼š\nå·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ SQLAlchemyï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼› ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ alembic upgrade head è¿™å‡ ä¸ªå‘½ä»¤ï¼› æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡ çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼› ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚ ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ\nåœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼› å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼› ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼› ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚ å¸¸è§ç—›ç‚¹ï¼š\nå¤šäººåä½œå›°éš¾ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ ç¯å¢ƒä¸ä¸€è‡´ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼› éš¾ä»¥å›æ»šï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼› å®¡è®¡å›°éš¾ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚ Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š\næŠŠâ€œæ•°æ®åº“ç»“æ„çš„å˜åŒ–â€å˜æˆä¸€æ¡å¯å›æ”¾ã€å¯å›æ»šã€å¯å®¡è®¡çš„æ—¶é—´çº¿ã€‚\nğŸ§© æ ¸å¿ƒæ¦‚å¿µï¼šAlembic é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯ æ¦‚å¿µ è¯´æ˜ Migration / è¿ç§» ä¸€æ¬¡æ•°æ®åº“ç»“æ„å˜æ›´ï¼ˆæ–°å¢è¡¨ã€åŠ å­—æ®µã€åˆ ç´¢å¼•ç­‰ï¼‰ï¼Œå¯¹åº”ä¸€ä¸ª Python è„šæœ¬ Revision / ç‰ˆæœ¬å· æ¯ä¸ªè¿ç§»è„šæœ¬çš„å”¯ä¸€ IDï¼Œé€šå¸¸æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶å­—ç¬¦ä¸² Upgrade ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼ˆæ‰§è¡Œ upgrade() å‡½æ•°ï¼‰ Downgrade ä»æ–°ç‰ˆæœ¬å›é€€åˆ°æ—§ç‰ˆæœ¬ï¼ˆæ‰§è¡Œ downgrade() å‡½æ•°ï¼‰ Head å½“å‰è¿ç§»é“¾çš„â€œæœ€æ–°ç‰ˆæœ¬â€ï¼ˆå¤´éƒ¨ï¼‰ env.py Alembic çš„å…¥å£æ–‡ä»¶ï¼Œè´Ÿè´£è¿æ¥æ•°æ®åº“ã€åŠ è½½æ¨¡å‹ã€è¿è¡Œè¿ç§» versions/ å­˜æ”¾æ‰€æœ‰è¿ç§»è„šæœ¬çš„ç›®å½• ç†è§£è¿™å‡ ä¸ªè¯ä¹‹åï¼ŒAlembic å°±ä¸é‚£ä¹ˆâ€œç„å­¦â€ï¼Œæ›´åƒæ˜¯ git ç‰ˆæœ¬ç®¡ç†çš„æ•°æ®åº“ç‰ˆï¼š\nalembic revision â‰ˆ git commit alembic upgrade â‰ˆ git checkout åˆ°æŸä¸ªæäº¤ alembic history â‰ˆ git log ğŸ›  å®è·µæŒ‡å— / æ­¥éª¤ï¼šç¬¬ä¸€æ¬¡ç”¨ Alembic ç®¡ç†ä½ çš„æ•°æ®åº“ å‡è®¾ä½ ç°åœ¨æœ‰ä¸€ä¸ªæœ€å°é¡¹ç›®ç»“æ„ï¼š\nmyapp/ app.py models.py db.py ä¸€ã€å®‰è£… Alembic åœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ï¼š\npip install alembic éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š\nalembic --version äºŒã€åˆå§‹åŒ– Alembic é¡¹ç›® åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ models.py åŒçº§ï¼‰æ‰§è¡Œï¼š\ncd myapp alembic init alembic ä¼šç”Ÿæˆï¼š\nmyapp/ alembic/ env.py script.py.mako versions/ alembic.ini app.py models.py db.py è¿™ä¸€æ­¥å®Œæˆäº†ï¼š\nåˆ›å»º Alembic é…ç½®æ–‡ä»¶ alembic.iniï¼› åˆ›å»ºå­˜æ”¾è¿ç§»è„šæœ¬çš„ç›®å½• alembic/versions/ï¼› åˆ›å»ºå…¥å£ alembic/env.pyã€‚ ä¸‰ã€é…ç½®æ•°æ®åº“è¿æ¥ + ç»‘å®š SQLAlchemy æ¨¡å‹ Alembic éœ€è¦çŸ¥é“ä¸¤ä»¶äº‹ï¼š\næ€ä¹ˆè¿åˆ°æ•°æ®åº“ï¼ˆè¿æ¥ URLï¼‰ï¼› è¦å¯¹æ¯”å“ªäº›æ¨¡å‹ï¼ˆtarget_metadataï¼‰ã€‚ 1ï¸âƒ£ è®¾ç½®æ•°æ®åº“ URL æ‰“å¼€æ ¹ç›®å½•çš„ alembic.iniï¼Œæ‰¾åˆ°ï¼š\nsqlalchemy.url = driver://user:pass@localhost/dbname æ”¹æˆä½ é¡¹ç›®ä¸­ç”¨çš„æ•°æ®åº“åœ°å€ï¼Œä¾‹å¦‚ï¼š\nsqlalchemy.url = mysql+pymysql://user:password@127.0.0.1:3306/mydb å¦‚æœä½ ä¸æƒ³æŠŠè¿æ¥ä¿¡æ¯å†™æ­»åœ¨ alembic.iniï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œç„¶ååœ¨ env.py é‡ŒåŠ¨æ€è¯»å–ï¼ˆè¿›é˜¶ç”¨æ³•ï¼Œæœ¬æ–‡å…ˆä¸å±•å¼€ï¼‰ã€‚\n2ï¸âƒ£ ç»‘å®š target_metadata å‡è®¾ä½ åœ¨ models.py ä¸­è¿™æ ·å®šä¹‰æ¨¡å‹ï¼š\n# models.py from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column from sqlalchemy import String, Integer class Base(DeclarativeBase): pass class User(Base): __tablename__ = \"users\" id: Mapped[int] = mapped_column(primary_key=True) name: Mapped[str] = mapped_column(String(50)) åœ¨ alembic/env.py é‡Œå¼•å…¥è¿™ä¸ª Baseï¼Œå¹¶è®¾ç½® target_metadataï¼š\n# alembic/env.py from logging.config import fileConfig from alembic import context from sqlalchemy import engine_from_config, pool from myapp.models import Base # â† å…³é”®ï¼šå¼•å…¥ä½ çš„ Base config = context.config if config.config_file_name is not None: fileConfig(config.config_file_name) target_metadata = Base.metadata # â† å…³é”®ï¼šå‘Šè¯‰ Alembic ä½ çš„æ¨¡å‹å…ƒæ•°æ® è¿™æ ·ï¼Œå½“ä½ ä½¿ç”¨ --autogenerate æ—¶ï¼ŒAlembic å°±ä¼šæ‹¿ Base.metadata é‡Œçš„ç»“æ„ä¸æ•°æ®åº“å½“å‰ç»“æ„åšå¯¹æ¯”ã€‚\nå››ã€ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆAutogenerateï¼‰ ç°åœ¨æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰ users è¿™å¼ è¡¨ï¼Œè€Œä½ çš„æ¨¡å‹é‡Œå·²ç»å®šä¹‰äº†å®ƒã€‚\nè®© Alembic å¸®æˆ‘ä»¬ç”Ÿæˆåˆ›å»ºè¯¥è¡¨çš„è¿ç§»ï¼š\nalembic revision --autogenerate -m \"create users table\" æ‰§è¡Œåï¼Œä¼šåœ¨ alembic/versions/ ä¸‹ç”Ÿæˆä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\nalembic/versions/ 20251128_123456_create_users_table.py æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¤§è‡´æ˜¯ï¼š\nfrom alembic import op import sqlalchemy as sa revision = \"20251128_123456\" down_revision = None branch_labels = None depends_on = None def upgrade() -\u003e None: op.create_table( \"users\", sa.Column(\"id\", sa.Integer(), primary_key=True), sa.Column(\"name\", sa.String(length=50), nullable=False), ) def downgrade() -\u003e None: op.drop_table(\"users\") è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦ç†è§£ï¼š\nupgrade()ï¼šå‡çº§æ—¶æ‰§è¡Œï¼Œåˆ›å»º users è¡¨ï¼› downgrade()ï¼šå›æ»šæ—¶æ‰§è¡Œï¼Œåˆ é™¤ users è¡¨ï¼› revision / down_revisionï¼šè¡¨ç¤ºâ€œæˆ‘æ˜¯è°ï¼Œæˆ‘çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬æ˜¯è°â€ï¼Œç”¨æ¥ä¸²æˆä¸€æ¡è¿ç§»é“¾ã€‚ éå¸¸é‡è¦ï¼šæ¯æ¬¡ autogenerate ç”Ÿæˆçš„è„šæœ¬ï¼Œéƒ½åº”è¯¥äººå·¥ review ä¸€éï¼Œè€Œä¸æ˜¯ç›²ç›®æ‰§è¡Œã€‚\näº”ã€åº”ç”¨è¿ç§»ï¼šå‡çº§å’Œå›æ»šæ•°æ®åº“ 1ï¸âƒ£ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆheadï¼‰ æ‰§è¡Œï¼š\nalembic upgrade head Alembic ä¼šï¼š\nè¿æ¥åˆ°ä½ é…ç½®çš„æ•°æ®åº“ï¼› åœ¨åº“é‡Œåˆ›å»ºä¸€ä¸ªåä¸º alembic_version çš„è¡¨ï¼Œè®°å½•å½“å‰ç‰ˆæœ¬å·ï¼› æ‰§è¡Œ upgrade()ï¼Œåˆ›å»º users è¡¨ã€‚ æ­¤æ—¶ä½ å¯ä»¥ç›´æ¥è¿æ¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹è¡¨ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚\n2ï¸âƒ£ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ å¦‚æœä½ æƒ³æ’¤é”€è¿™æ¬¡è¿ç§»ï¼Œåªè¦ï¼š\nalembic downgrade -1 Alembic ä¼šæ‰¾åˆ°â€œä¸Šä¸€ä¸ªç‰ˆæœ¬â€ï¼Œæ‰§è¡Œå½“å‰è„šæœ¬çš„ downgrade()ï¼ŒæŠŠ users è¡¨åˆ æ‰ã€‚\nä½ ä¹Ÿå¯ä»¥æŒ‡å®šå›åˆ°æŸä¸ªå…·ä½“ç‰ˆæœ¬ï¼š\nalembic downgrade 20251128_123456 å‡çº§åŒç†ï¼š\nalembic upgrade 20251128_123456 å…­ã€åç»­è¿­ä»£ï¼šæ¨¡å‹å˜æ›´ â†’ è¿ç§»è„šæœ¬ â†’ å‡çº§ åç»­å¼€å‘ä¸­ï¼Œä½ çš„æµç¨‹åº”è¯¥å°½é‡å˜æˆï¼š\nä¿®æ”¹ models.py ä¸­çš„æ¨¡å‹ï¼Œæ¯”å¦‚ç»™ User åŠ ä¸€ä¸ª email å­—æ®µï¼š\nclass User(Base): __tablename__ = \"users\" id: Mapped[int] = mapped_column(primary_key=True) name: Mapped[str] = mapped_column(String(50)) email: Mapped[str] = mapped_column(String(100), nullable=True) ç”Ÿæˆè¿ç§»è„šæœ¬ï¼š\nalembic revision --autogenerate -m \"add email to user\" æ‰“å¼€ç”Ÿæˆçš„è„šæœ¬ï¼Œç¡®è®¤å†…å®¹å¤§è‡´æ˜¯ï¼š\ndef upgrade() -\u003e None: op.add_column(\"users\", sa.Column(\"email\", sa.String(length=100), nullable=True)) def downgrade() -\u003e None: op.drop_column(\"users\", \"email\") æ‰§è¡Œè¿ç§»ï¼š\nalembic upgrade head åœ¨ä»£ç ä¸­å¼€å§‹ä½¿ç”¨ User.email å­—æ®µã€‚\nå…³é”®åŸåˆ™ï¼šæ°¸è¿œè®© Alembic æˆä¸ºâ€œå”¯ä¸€ä¿®æ”¹æ•°æ®åº“ç»“æ„çš„å…¥å£â€ã€‚\nğŸ§ª å¯è¿è¡Œç¤ºä¾‹ï¼šä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§» ä¸‹é¢æ˜¯ä¸€å¥—ä½ å¯ä»¥å¤åˆ¶åˆ°æœ¬åœ°å°è¯•çš„æœ€å°ç¤ºä¾‹ã€‚\næ–°å»ºé¡¹ç›®ç›®å½•ï¼š\nmkdir alembic-demo cd alembic-demo python -m venv .venv source .venv/bin/activate # Windows ä½¿ç”¨ .venv\\Scripts\\activate pip install sqlalchemy alembic pymysql åˆ›å»º models.pyï¼š\n# models.py from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column from sqlalchemy import String, Integer class Base(DeclarativeBase): pass class User(Base): __tablename__ = \"users\" id: Mapped[int] = mapped_column(Integer, primary_key=True) name: Mapped[str] = mapped_column(String(50)) åˆå§‹åŒ– Alembicï¼š\nalembic init alembic ä¿®æ”¹ alembic.iniï¼š\nsqlalchemy.url = mysql+pymysql://user:password@127.0.0.1:3306/alembic_demo ï¼ˆæå‰åœ¨æ•°æ®åº“ä¸­å»ºå¥½ alembic_demo è¿™ä¸ªåº“ã€‚ï¼‰\nä¿®æ”¹ alembic/env.pyï¼Œå¼•å…¥ Baseï¼š\nfrom myproject.models import Base # æŒ‰ä½ çš„çœŸå®åŒ…åä¿®æ”¹ target_metadata = Base.metadata ç”Ÿæˆå¹¶åº”ç”¨è¿ç§»ï¼š\nalembic revision --autogenerate -m \"create users table\" alembic upgrade head å®Œæˆåï¼Œä½ çš„æ•°æ®åº“ä¸­å°±ä¼šå‡ºç° users è¡¨å’Œ alembic_version è¡¨ã€‚\nâš™ï¸ è§£é‡Šä¸åŸç†ï¼šAlembic åœ¨èƒŒååšäº†ä»€ä¹ˆï¼Ÿ ç®€å•ç†è§£ Alembic çš„å†…éƒ¨æµç¨‹ï¼š\nç‰ˆæœ¬ç®¡ç†ï¼š\næ¯ä¸ªè¿ç§»è„šæœ¬éƒ½æœ‰è‡ªå·±çš„ revision å’Œ down_revisionï¼› æ•°æ®åº“é‡Œæœ‰ä¸€å¼  alembic_version è¡¨åªå­˜ä¸€ä¸ªå­—æ®µï¼šå½“å‰ç‰ˆæœ¬å·ï¼› å‡çº§æ—¶ï¼šæ ¹æ®å½“å‰ç‰ˆæœ¬ â†’ æ‰¾åˆ°ç›®æ ‡ç‰ˆæœ¬ â†’ ä¾åºæ‰§è¡Œ upgrade()ï¼› å›æ»šæ—¶ï¼šæŒ‰åæ–¹å‘æ‰§è¡Œ downgrade()ã€‚ è‡ªåŠ¨å¯¹æ¯”ï¼ˆautogenerateï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š\nAlembic ç”¨ target_metadata ä»£è¡¨â€œæ¨¡å‹ä¸­çš„ç»“æ„â€ï¼› è¿æ¥æ•°æ®åº“ï¼Œè¯»å–çœŸå®è¡¨ç»“æ„ï¼› å¯¹æ¯”ä¸¤è€…çš„å·®å¼‚ï¼Œç”Ÿæˆå¯¹åº”çš„ op.create_table / op.add_column ç­‰æ“ä½œï¼› æŠŠè¿™äº›æ“ä½œå†™å…¥ versions/*.pyã€‚ ä¸ºä»€ä¹ˆå¿…é¡»äººå·¥ review è„šæœ¬ï¼š\næŸäº›ç±»å‹ï¼ˆå¦‚ Enumã€server_defaultï¼‰åœ¨ä¸åŒæ•°æ®åº“æ–¹è¨€ä¸‹è¡¨ç°ä¸åŒï¼› æœªæ¥ä½ å¯èƒ½ä¼šåŠ ä¸Šâ€œæ•°æ®è¿ç§»â€é€»è¾‘ï¼Œåªé è‡ªåŠ¨ç”Ÿæˆä¸å¤Ÿï¼› è‡ªåŠ¨ç”Ÿæˆä¸äº†â€œä¸šåŠ¡æ„å›¾â€ï¼Œä¾‹å¦‚ï¼šç»™æ–°åˆ—å¡«è¡¥é»˜è®¤å€¼ã€è¿ç§»æ—§å­—æ®µçš„æ•°æ®ç­‰ã€‚ âš ï¸ å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹ é—®é¢˜ / åœºæ™¯ å»ºè®®åšæ³• alembic revision --autogenerate ä¸ç”Ÿæˆä»»ä½•å†…å®¹ æ£€æŸ¥ env.py æ˜¯å¦æ­£ç¡®è®¾ç½® target_metadataï¼Œä»¥åŠæ¨¡å‹æ˜¯å¦çœŸçš„å˜æ›´ ç”Ÿæˆçš„è„šæœ¬ä¸çœŸå®æœŸæœ›ä¸ä¸€è‡´ æ‰‹åŠ¨ç¼–è¾‘ versions/*.py ä¸­çš„ upgrade() / downgrade() å¤šäººå¼€å‘æ—¶ç‰ˆæœ¬å·å†²çª å°½é‡ä¿æŒä¸€ä¸ªäººè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯çš„è¿ç§»ï¼Œå¹¶åŠæ—¶åˆå¹¶ï¼›å¿…è¦æ—¶æ‰‹å·¥è°ƒæ•´ down_revision å…³ç³» æƒ³é‡å»ºä¸€ä»½â€œå¹²å‡€â€çš„è¿ç§»é“¾ åœ¨æ–°å»ºæ•°æ®åº“ç¯å¢ƒæ—¶å¯ä»¥åˆå¹¶å†å²è¿ç§»ï¼›å¯¹å·²æœ‰ç”Ÿäº§ç¯å¢ƒè¯·æ…é‡ï¼Œé€šå¸¸åªåšè¿½åŠ ä¸åšé‡æ’ ç”Ÿäº§ç¯å¢ƒå®³æ€•ç›´æ¥æ‰§è¡Œè¿ç§» å…ˆåœ¨æµ‹è¯• / staging ç¯å¢ƒå®Œæ•´è·‘ä¸€éè¿ç§»ï¼Œå†ä¸Šçº¿ï¼›å¿…è¦æ—¶å¯¼å‡º SQL åšäººå·¥å®¡æ ¸ ğŸŒŸ æœ€ä½³å®è·µä¸å»ºè®® æ°¸è¿œä¸è¦ç›´æ¥åœ¨æ•°æ®åº“é‡Œæ‰‹æ”¹ç»“æ„ï¼Œæ‰€æœ‰å˜æ›´å°½é‡é€šè¿‡ Alembic ç®¡ç†ã€‚ æ¯æ¬¡è¿è¡Œ --autogenerate åï¼Œéƒ½è¦æ‰“å¼€ç”Ÿæˆçš„è„šæœ¬ è®¤çœŸçœ‹ä¸€éã€‚ æŠŠ alembic.iniã€alembic/ã€versions/ å…¨éƒ¨æäº¤åˆ° Git ä¸­ï¼Œä¿è¯å›¢é˜Ÿå…±äº«åŒä¸€å¥—å†å²ã€‚ åœ¨ CI ä¸­åŠ ä¸€æ¡â€œè¿ç§»æ£€æŸ¥â€ï¼šæ‹‰èµ·ä¸€ä¸ªæµ‹è¯•åº“ï¼Œè·‘ä¸€é alembic upgrade head ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œã€‚ å¯¹ç”Ÿäº§æ•°æ®åº“æ‰§è¡Œè¿ç§»å‰ï¼Œä¸€å®šè¦ï¼š æœ‰æœ€è¿‘çš„å¤‡ä»½ï¼› åœ¨æµ‹è¯•ç¯å¢ƒæ¼”ç»ƒè¿‡ä¸€æ¬¡ï¼› æœ€å¥½æœ‰å›æ»šæ–¹æ¡ˆï¼ˆdowngrade æˆ–æ‰‹å·¥ SQLï¼‰ã€‚ ğŸ“š å°ç»“ / ç»“è®º è¿™ç¯‡å…¥é—¨æ–‡ç« å¸¦ä½ èµ°å®Œäº† Alembic çš„æœ€å°é—­ç¯ï¼š\nå®‰è£… Alembicï¼Œå¹¶åœ¨é¡¹ç›®ä¸­åˆå§‹åŒ–ï¼› é€šè¿‡ env.py ç»‘å®š SQLAlchemy æ¨¡å‹ï¼ˆtarget_metadataï¼‰ï¼› ç”¨ revision --autogenerate ç”Ÿæˆè¿ç§»è„šæœ¬ï¼› ç”¨ upgrade / downgrade ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬ï¼› å½¢æˆâ€œæ¨¡å‹å˜æ›´ â†’ ç”Ÿæˆè¿ç§» â†’ æ‰§è¡Œè¿ç§»â€çš„æ ‡å‡†æµç¨‹ã€‚ ç†è§£äº†è¿™äº›ï¼Œä½ å·²ç»å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œæ”¾å¿ƒä½¿ç”¨ Alembic äº†ã€‚\nåç»­ä½ è¿˜å¯ä»¥ç»§ç»­å­¦ä¹ ï¼š\nå¤šç¯å¢ƒé…ç½®ï¼ˆå¼€å‘ / æµ‹è¯• / ç”Ÿäº§ä¸åŒæ•°æ®åº“ï¼‰ï¼› æ•°æ®è¿ç§»ã€æ‰¹é‡æ›´æ–°ï¼› é«˜çº§å¹²é¢„ï¼ˆinclude_objectã€process_revision_directives ç­‰ï¼‰â€”â€” å¯ä»¥ç»“åˆæˆ‘å†™çš„å¦ä¸€ç¯‡ã€Šå¦‚ä½•å¹²é¢„ Alembicï¼šä»è‡ªåŠ¨ç”Ÿæˆåˆ°ç²¾ç»†æ§åˆ¶ã€‹ä¸€èµ·çœ‹ã€‚ ğŸ”— å‚è€ƒä¸å»¶ä¼¸é˜…è¯» Alembic å®˜æ–¹æ–‡æ¡£ï¼šhttps://alembic.sqlalchemy.org/ SQLAlchemy å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.sqlalchemy.org/ â€œEnvironment \u0026 Migration Contextâ€ï¼ˆå®˜æ–¹æ–‡æ¡£ä¸­å…³äº env.py çš„ç« èŠ‚ï¼‰ ã€Šå¦‚ä½•å¹²é¢„ Alembicï¼šä»è‡ªåŠ¨ç”Ÿæˆåˆ°ç²¾ç»†æ§åˆ¶ã€‹ï¼ˆåŒä¸€ä¸“æ çš„è¿›é˜¶ç¯‡ï¼‰ ğŸ·ï¸ å…ƒä¿¡æ¯ é˜…è¯»æ—¶é•¿ï¼š8â€“12 åˆ†é’Ÿ æ ‡ç­¾ï¼šPythonï¼ŒAlembicï¼ŒSQLAlchemyï¼Œæ•°æ®åº“è¿ç§»ï¼Œåç«¯å…¥é—¨ SEO å…³é”®è¯ï¼šAlembic å…¥é—¨ï¼ŒSQLAlchemy æ•°æ®åº“è¿ç§»ï¼Œalembic tutorialï¼ŒPython æ•°æ®åº“ç‰ˆæœ¬ç®¡ç† å…ƒæè¿°ï¼šè¿™æ˜¯ä¸€ç¯‡é¢å‘åˆå­¦è€…çš„ Alembic å…¥é—¨æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ ä»é›¶é…ç½® Alembicï¼Œä¸ SQLAlchemy æ¨¡å‹è”åŠ¨ï¼Œå®Œæˆæ•°æ®åº“è¿ç§»çš„ç”Ÿæˆã€å‡çº§ä¸å›æ»šã€‚ ğŸš€ è¡ŒåŠ¨å·å¬ï¼ˆCTAï¼‰ ç°åœ¨å°±å¯ä»¥åœ¨ä½ çš„é¡¹ç›®é‡Œè¯•è¯•ï¼š\næŠŠç°æœ‰ SQLAlchemy æ¨¡å‹ä¸ Alembic è¿æ¥èµ·æ¥ï¼› ç”¨ alembic revision --autogenerate ç”Ÿæˆç¬¬ä¸€ä»½è¿ç§»è„šæœ¬ï¼› åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªå¹²å‡€æ•°æ®åº“ï¼Œè·‘ä¸€é alembic upgrade headï¼Œæ„Ÿå—â€œä»æ— åˆ°æœ‰å»ºå‡ºå…¨éƒ¨è¡¨â€çš„è¿‡ç¨‹ã€‚ å¦‚æœä½ åœ¨æ¥å…¥ Alembic çš„è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼ˆé…ç½®ã€å‘½ä»¤ã€è„šæœ¬å†²çªç­‰ï¼‰ï¼Œå¯ä»¥æŠŠæŠ¥é”™å’Œ env.py ç‰‡æ®µè´´å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¡æ¡ä¸€èµ·æ‹†ã€‚\n",
  "wordCount" : "755",
  "inLanguage": "zh",
  "datePublished": "2025-11-28T00:00:00Z",
  "dateModified": "2025-11-28T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/dev/python/alembic-intro-sqlalchemy-migrations/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jeanphilo Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Jeanphilo Blog (Alt + H)">Jeanphilo Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/en/" title="English"
                                aria-label="English">En</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="æ–‡ç« å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/dev/" title="å¼€å‘">
                    <span>å¼€å‘</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/alg/" title="ç®—æ³•">
                    <span>ç®—æ³•</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/dev/">å¼€å‘</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/dev/python/">Python</a></div>
    <h1 class="post-title entry-hint-parent">
      Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»
    </h1>
    <div class="post-meta"><span title='2025-11-28 00:00:00 +0000 UTC'>2025å¹´11æœˆ28æ—¥</span>&nbsp;Â·&nbsp;<span>4 åˆ†é’Ÿ</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#-alembic-%e5%85%a5%e9%97%a8%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8-sqlalchemy-%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb" aria-label="ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»">ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»</a><ul>
                        
                <li>
                    <a href="#-%e5%89%af%e6%a0%87%e9%a2%98--%e6%91%98%e8%a6%81" aria-label="ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦">ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦</a></li>
                <li>
                    <a href="#-%e7%9b%ae%e6%a0%87%e8%af%bb%e8%80%85" aria-label="ğŸ¯ ç›®æ ‡è¯»è€…">ğŸ¯ ç›®æ ‡è¯»è€…</a></li>
                <li>
                    <a href="#-%e8%83%8c%e6%99%af--%e5%8a%a8%e6%9c%ba%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb%e5%b7%a5%e5%85%b7" aria-label="ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ">ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ</a></li>
                <li>
                    <a href="#-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5alembic-%e9%87%8c%e4%bd%a0%e5%bf%85%e9%a1%bb%e8%ae%a4%e8%af%86%e7%9a%84%e5%87%a0%e4%b8%aa%e8%af%8d" aria-label="ğŸ§© æ ¸å¿ƒæ¦‚å¿µï¼šAlembic é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯">ğŸ§© æ ¸å¿ƒæ¦‚å¿µï¼šAlembic é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯</a></li>
                <li>
                    <a href="#-%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%8d%97--%e6%ad%a5%e9%aa%a4%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8-alembic-%e7%ae%a1%e7%90%86%e4%bd%a0%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="ğŸ›  å®è·µæŒ‡å— / æ­¥éª¤ï¼šç¬¬ä¸€æ¬¡ç”¨ Alembic ç®¡ç†ä½ çš„æ•°æ®åº“">ğŸ›  å®è·µæŒ‡å— / æ­¥éª¤ï¼šç¬¬ä¸€æ¬¡ç”¨ Alembic ç®¡ç†ä½ çš„æ•°æ®åº“</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e5%ae%89%e8%a3%85-alembic" aria-label="ä¸€ã€å®‰è£… Alembic">ä¸€ã€å®‰è£… Alembic</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%88%9d%e5%a7%8b%e5%8c%96-alembic-%e9%a1%b9%e7%9b%ae" aria-label="äºŒã€åˆå§‹åŒ– Alembic é¡¹ç›®">äºŒã€åˆå§‹åŒ– Alembic é¡¹ç›®</a></li>
                <li>
                    <a href="#%e4%b8%89%e9%85%8d%e7%bd%ae%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5--%e7%bb%91%e5%ae%9a-sqlalchemy-%e6%a8%a1%e5%9e%8b" aria-label="ä¸‰ã€é…ç½®æ•°æ®åº“è¿æ¥ &#43; ç»‘å®š SQLAlchemy æ¨¡å‹">ä¸‰ã€é…ç½®æ•°æ®åº“è¿æ¥ + ç»‘å®š SQLAlchemy æ¨¡å‹</a><ul>
                        
                <li>
                    <a href="#1-%e8%ae%be%e7%bd%ae%e6%95%b0%e6%8d%ae%e5%ba%93-url" aria-label="1ï¸âƒ£ è®¾ç½®æ•°æ®åº“ URL">1ï¸âƒ£ è®¾ç½®æ•°æ®åº“ URL</a></li>
                <li>
                    <a href="#2-%e7%bb%91%e5%ae%9a-target_metadata" aria-label="2ï¸âƒ£ ç»‘å®š target_metadata">2ï¸âƒ£ ç»‘å®š target_metadata</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%9f%e6%88%90%e8%bf%81%e7%a7%bb%e8%84%9a%e6%9c%acautogenerate" aria-label="å››ã€ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆAutogenerateï¼‰">å››ã€ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆAutogenerateï¼‰</a></li>
                <li>
                    <a href="#%e4%ba%94%e5%ba%94%e7%94%a8%e8%bf%81%e7%a7%bb%e5%8d%87%e7%ba%a7%e5%92%8c%e5%9b%9e%e6%bb%9a%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="äº”ã€åº”ç”¨è¿ç§»ï¼šå‡çº§å’Œå›æ»šæ•°æ®åº“">äº”ã€åº”ç”¨è¿ç§»ï¼šå‡çº§å’Œå›æ»šæ•°æ®åº“</a><ul>
                        
                <li>
                    <a href="#1-%e5%8d%87%e7%ba%a7%e5%88%b0%e6%9c%80%e6%96%b0%e7%89%88%e6%9c%achead" aria-label="1ï¸âƒ£ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆheadï¼‰">1ï¸âƒ£ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆheadï¼‰</a></li>
                <li>
                    <a href="#2-%e5%9b%9e%e6%bb%9a%e5%88%b0%e4%b8%8a%e4%b8%80%e4%b8%aa%e7%89%88%e6%9c%ac" aria-label="2ï¸âƒ£ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬">2ï¸âƒ£ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%ad%e5%90%8e%e7%bb%ad%e8%bf%ad%e4%bb%a3%e6%a8%a1%e5%9e%8b%e5%8f%98%e6%9b%b4--%e8%bf%81%e7%a7%bb%e8%84%9a%e6%9c%ac--%e5%8d%87%e7%ba%a7" aria-label="å…­ã€åç»­è¿­ä»£ï¼šæ¨¡å‹å˜æ›´ â†’ è¿ç§»è„šæœ¬ â†’ å‡çº§">å…­ã€åç»­è¿­ä»£ï¼šæ¨¡å‹å˜æ›´ â†’ è¿ç§»è„šæœ¬ â†’ å‡çº§</a></li></ul>
                </li>
                <li>
                    <a href="#-%e5%8f%af%e8%bf%90%e8%a1%8c%e7%a4%ba%e4%be%8b%e4%bb%8e%e9%9b%b6%e5%88%b0%e7%ac%ac%e4%b8%80%e4%b8%aa%e8%bf%81%e7%a7%bb" aria-label="ğŸ§ª å¯è¿è¡Œç¤ºä¾‹ï¼šä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§»">ğŸ§ª å¯è¿è¡Œç¤ºä¾‹ï¼šä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§»</a></li>
                <li>
                    <a href="#-%e8%a7%a3%e9%87%8a%e4%b8%8e%e5%8e%9f%e7%90%86alembic-%e5%9c%a8%e8%83%8c%e5%90%8e%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88" aria-label="âš™ï¸ è§£é‡Šä¸åŸç†ï¼šAlembic åœ¨èƒŒååšäº†ä»€ä¹ˆï¼Ÿ">âš™ï¸ è§£é‡Šä¸åŸç†ï¼šAlembic åœ¨èƒŒååšäº†ä»€ä¹ˆï¼Ÿ</a></li>
                <li>
                    <a href="#-%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98%e4%b8%8e%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="âš ï¸ å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹">âš ï¸ å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</a></li>
                <li>
                    <a href="#-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e4%b8%8e%e5%bb%ba%e8%ae%ae" aria-label="ğŸŒŸ æœ€ä½³å®è·µä¸å»ºè®®">ğŸŒŸ æœ€ä½³å®è·µä¸å»ºè®®</a></li>
                <li>
                    <a href="#-%e5%b0%8f%e7%bb%93--%e7%bb%93%e8%ae%ba" aria-label="ğŸ“š å°ç»“ / ç»“è®º">ğŸ“š å°ç»“ / ç»“è®º</a></li>
                <li>
                    <a href="#-%e5%8f%82%e8%80%83%e4%b8%8e%e5%bb%b6%e4%bc%b8%e9%98%85%e8%af%bb" aria-label="ğŸ”— å‚è€ƒä¸å»¶ä¼¸é˜…è¯»">ğŸ”— å‚è€ƒä¸å»¶ä¼¸é˜…è¯»</a></li>
                <li>
                    <a href="#-%e5%85%83%e4%bf%a1%e6%81%af" aria-label="ğŸ·ï¸ å…ƒä¿¡æ¯">ğŸ·ï¸ å…ƒä¿¡æ¯</a></li>
                <li>
                    <a href="#-%e8%a1%8c%e5%8a%a8%e5%8f%b7%e5%8f%accta" aria-label="ğŸš€ è¡ŒåŠ¨å·å¬ï¼ˆCTAï¼‰">ğŸš€ è¡ŒåŠ¨å·å¬ï¼ˆCTAï¼‰</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="-alembic-å…¥é—¨ç¬¬ä¸€æ¬¡ç”¨-sqlalchemy-åšæ•°æ®åº“è¿ç§»">ğŸ£ Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§»<a hidden class="anchor" aria-hidden="true" href="#-alembic-å…¥é—¨ç¬¬ä¸€æ¬¡ç”¨-sqlalchemy-åšæ•°æ®åº“è¿ç§»">#</a></h1>
<h2 id="-å‰¯æ ‡é¢˜--æ‘˜è¦">ğŸ’¡ å‰¯æ ‡é¢˜ / æ‘˜è¦<a hidden class="anchor" aria-hidden="true" href="#-å‰¯æ ‡é¢˜--æ‘˜è¦">#</a></h2>
<p>å¦‚æœä½ å·²ç»åœ¨ç”¨ SQLAlchemy æ“ä½œæ•°æ®åº“ï¼Œå´è¿˜åœ¨é â€œæ‰‹å·¥æ”¹è¡¨ç»“æ„ + å¯¼å‡ºå¯¼å…¥ SQLâ€æ¥ç»´æŠ¤ schemaï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ ç”¨æœ€å°æˆæœ¬ä¸Šæ‰‹ Alembicã€‚<br>
æˆ‘ä»¬ä¼šä» <strong>0 é…ç½® Alembic</strong> å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆï¼šç”Ÿæˆè¿ç§»ã€å‡çº§/å›æ»šæ•°æ®åº“ã€å’Œ SQLAlchemy æ¨¡å‹è”åŠ¨ã€‚</p>
<hr>
<h2 id="-ç›®æ ‡è¯»è€…">ğŸ¯ ç›®æ ‡è¯»è€…<a hidden class="anchor" aria-hidden="true" href="#-ç›®æ ‡è¯»è€…">#</a></h2>
<p>é€‚åˆè¿™æ ·çš„ä½ ï¼š</p>
<ul>
<li>å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <strong>SQLAlchemy</strong>ï¼ˆORM æˆ– Core éƒ½è¡Œï¼‰ï¼›</li>
<li>ä»æœªä½¿ç”¨è¿‡ Alembicï¼Œæˆ–åªæ‡‚ <code>alembic upgrade head</code> è¿™å‡ ä¸ªå‘½ä»¤ï¼›</li>
<li>æƒ³ä¸ºè‡ªå·±çš„é¡¹ç›®åŠ ä¸Š <strong>å¯å›æ»šã€å¯è¿½è¸ªã€å¯å®¡è®¡</strong> çš„æ•°æ®åº“ç»“æ„å˜æ›´ï¼›</li>
<li>ä»¥ Python / Web åç«¯ä¸ºä¸»ï¼ˆFlask / FastAPI / è‡ªç ”æ¡†æ¶å‡å¯ï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="-èƒŒæ™¯--åŠ¨æœºä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·">ğŸ”¥ èƒŒæ™¯ / åŠ¨æœºï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-èƒŒæ™¯--åŠ¨æœºä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿ç§»å·¥å…·">#</a></h2>
<p>æ²¡æœ‰ Alembic æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ€ä¹ˆæ”¹æ•°æ®åº“ç»“æ„ï¼Ÿ</p>
<ul>
<li>åœ¨æœ¬åœ°æ‰‹æ”¹è¡¨ç»“æ„ï¼ˆæ”¹å­—æ®µã€åŠ ç´¢å¼•ï¼‰ï¼›</li>
<li>å¯¼å‡º SQL å‘ç»™åŒäº‹ / DBAï¼›</li>
<li>ç”Ÿäº§ç¯å¢ƒå†æ‰‹å·¥æ‰§è¡Œä¸€æ¬¡ï¼›</li>
<li>ä¸€æ—¦å‡ºé”™ï¼Œå›æ»šéå¸¸ç—›è‹¦ã€‚</li>
</ul>
<p>å¸¸è§ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>å¤šäººåä½œå›°éš¾</strong>ï¼šè°å…ˆæ”¹ï¼Ÿè°åæ”¹ï¼Ÿæ”¹äº†ä»€ä¹ˆï¼Ÿ</li>
<li><strong>ç¯å¢ƒä¸ä¸€è‡´</strong>ï¼šæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§çš„è¡¨ç»“æ„ç»å¸¸ä¸ä¸€æ ·ï¼›</li>
<li><strong>éš¾ä»¥å›æ»š</strong>ï¼šä¸€æ—¦ä¸Šçº¿å‘ç°é—®é¢˜ï¼Œå¾ˆéš¾å®‰å…¨é€€å›ä¹‹å‰ç‰ˆæœ¬ï¼›</li>
<li><strong>å®¡è®¡å›°éš¾</strong>ï¼šå‡ å¹´åæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªè¡¨ä¸ºä»€ä¹ˆå¤šäº†å‡ ä¸ªå­—æ®µã€‚</li>
</ul>
<p>Alembic åšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>æŠŠâ€œæ•°æ®åº“ç»“æ„çš„å˜åŒ–â€å˜æˆä¸€æ¡å¯å›æ”¾ã€å¯å›æ»šã€å¯å®¡è®¡çš„æ—¶é—´çº¿ã€‚</strong></p>
</blockquote>
<hr>
<h2 id="-æ ¸å¿ƒæ¦‚å¿µalembic-é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯">ğŸ§© æ ¸å¿ƒæ¦‚å¿µï¼šAlembic é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯<a hidden class="anchor" aria-hidden="true" href="#-æ ¸å¿ƒæ¦‚å¿µalembic-é‡Œä½ å¿…é¡»è®¤è¯†çš„å‡ ä¸ªè¯">#</a></h2>
<table>
  <thead>
      <tr>
          <th>æ¦‚å¿µ</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Migration / è¿ç§»</strong></td>
          <td>ä¸€æ¬¡æ•°æ®åº“ç»“æ„å˜æ›´ï¼ˆæ–°å¢è¡¨ã€åŠ å­—æ®µã€åˆ ç´¢å¼•ç­‰ï¼‰ï¼Œå¯¹åº”ä¸€ä¸ª Python è„šæœ¬</td>
      </tr>
      <tr>
          <td><strong>Revision / ç‰ˆæœ¬å·</strong></td>
          <td>æ¯ä¸ªè¿ç§»è„šæœ¬çš„å”¯ä¸€ IDï¼Œé€šå¸¸æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶å­—ç¬¦ä¸²</td>
      </tr>
      <tr>
          <td><strong>Upgrade</strong></td>
          <td>ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼ˆæ‰§è¡Œ <code>upgrade()</code> å‡½æ•°ï¼‰</td>
      </tr>
      <tr>
          <td><strong>Downgrade</strong></td>
          <td>ä»æ–°ç‰ˆæœ¬å›é€€åˆ°æ—§ç‰ˆæœ¬ï¼ˆæ‰§è¡Œ <code>downgrade()</code> å‡½æ•°ï¼‰</td>
      </tr>
      <tr>
          <td><strong>Head</strong></td>
          <td>å½“å‰è¿ç§»é“¾çš„â€œæœ€æ–°ç‰ˆæœ¬â€ï¼ˆå¤´éƒ¨ï¼‰</td>
      </tr>
      <tr>
          <td><strong>env.py</strong></td>
          <td>Alembic çš„å…¥å£æ–‡ä»¶ï¼Œè´Ÿè´£è¿æ¥æ•°æ®åº“ã€åŠ è½½æ¨¡å‹ã€è¿è¡Œè¿ç§»</td>
      </tr>
      <tr>
          <td><strong>versions/</strong></td>
          <td>å­˜æ”¾æ‰€æœ‰è¿ç§»è„šæœ¬çš„ç›®å½•</td>
      </tr>
  </tbody>
</table>
<p>ç†è§£è¿™å‡ ä¸ªè¯ä¹‹åï¼ŒAlembic å°±ä¸é‚£ä¹ˆâ€œç„å­¦â€ï¼Œæ›´åƒæ˜¯ <strong>git ç‰ˆæœ¬ç®¡ç†çš„æ•°æ®åº“ç‰ˆ</strong>ï¼š</p>
<ul>
<li><code>alembic revision</code> â‰ˆ <code>git commit</code></li>
<li><code>alembic upgrade</code> â‰ˆ <code>git checkout</code> åˆ°æŸä¸ªæäº¤</li>
<li><code>alembic history</code> â‰ˆ <code>git log</code></li>
</ul>
<hr>
<h2 id="-å®è·µæŒ‡å—--æ­¥éª¤ç¬¬ä¸€æ¬¡ç”¨-alembic-ç®¡ç†ä½ çš„æ•°æ®åº“">ğŸ›  å®è·µæŒ‡å— / æ­¥éª¤ï¼šç¬¬ä¸€æ¬¡ç”¨ Alembic ç®¡ç†ä½ çš„æ•°æ®åº“<a hidden class="anchor" aria-hidden="true" href="#-å®è·µæŒ‡å—--æ­¥éª¤ç¬¬ä¸€æ¬¡ç”¨-alembic-ç®¡ç†ä½ çš„æ•°æ®åº“">#</a></h2>
<p>å‡è®¾ä½ ç°åœ¨æœ‰ä¸€ä¸ªæœ€å°é¡¹ç›®ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>myapp/
</span></span><span style="display:flex;"><span>  app.py
</span></span><span style="display:flex;"><span>  models.py
</span></span><span style="display:flex;"><span>  db.py
</span></span></code></pre></div><h3 id="ä¸€å®‰è£…-alembic">ä¸€ã€å®‰è£… Alembic<a hidden class="anchor" aria-hidden="true" href="#ä¸€å®‰è£…-alembic">#</a></h3>
<p>åœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install alembic
</span></span></code></pre></div><p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic --version
</span></span></code></pre></div><hr>
<h3 id="äºŒåˆå§‹åŒ–-alembic-é¡¹ç›®">äºŒã€åˆå§‹åŒ– Alembic é¡¹ç›®<a hidden class="anchor" aria-hidden="true" href="#äºŒåˆå§‹åŒ–-alembic-é¡¹ç›®">#</a></h3>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ <code>models.py</code> åŒçº§ï¼‰æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd myapp
</span></span><span style="display:flex;"><span>alembic init alembic
</span></span></code></pre></div><p>ä¼šç”Ÿæˆï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>myapp/
</span></span><span style="display:flex;"><span>  alembic/
</span></span><span style="display:flex;"><span>    env.py
</span></span><span style="display:flex;"><span>    script.py.mako
</span></span><span style="display:flex;"><span>    versions/
</span></span><span style="display:flex;"><span>  alembic.ini
</span></span><span style="display:flex;"><span>  app.py
</span></span><span style="display:flex;"><span>  models.py
</span></span><span style="display:flex;"><span>  db.py
</span></span></code></pre></div><p>è¿™ä¸€æ­¥å®Œæˆäº†ï¼š</p>
<ul>
<li>åˆ›å»º Alembic é…ç½®æ–‡ä»¶ <code>alembic.ini</code>ï¼›</li>
<li>åˆ›å»ºå­˜æ”¾è¿ç§»è„šæœ¬çš„ç›®å½• <code>alembic/versions/</code>ï¼›</li>
<li>åˆ›å»ºå…¥å£ <code>alembic/env.py</code>ã€‚</li>
</ul>
<hr>
<h3 id="ä¸‰é…ç½®æ•°æ®åº“è¿æ¥--ç»‘å®š-sqlalchemy-æ¨¡å‹">ä¸‰ã€é…ç½®æ•°æ®åº“è¿æ¥ + ç»‘å®š SQLAlchemy æ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#ä¸‰é…ç½®æ•°æ®åº“è¿æ¥--ç»‘å®š-sqlalchemy-æ¨¡å‹">#</a></h3>
<p>Alembic éœ€è¦çŸ¥é“ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><strong>æ€ä¹ˆè¿åˆ°æ•°æ®åº“</strong>ï¼ˆè¿æ¥ URLï¼‰ï¼›</li>
<li><strong>è¦å¯¹æ¯”å“ªäº›æ¨¡å‹</strong>ï¼ˆ<code>target_metadata</code>ï¼‰ã€‚</li>
</ol>
<h4 id="1-è®¾ç½®æ•°æ®åº“-url">1ï¸âƒ£ è®¾ç½®æ•°æ®åº“ URL<a hidden class="anchor" aria-hidden="true" href="#1-è®¾ç½®æ•°æ®åº“-url">#</a></h4>
<p>æ‰“å¼€æ ¹ç›®å½•çš„ <code>alembic.ini</code>ï¼Œæ‰¾åˆ°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">sqlalchemy.url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">driver://user:pass@localhost/dbname</span>
</span></span></code></pre></div><p>æ”¹æˆä½ é¡¹ç›®ä¸­ç”¨çš„æ•°æ®åº“åœ°å€ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">sqlalchemy.url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://user:password@127.0.0.1:3306/mydb</span>
</span></span></code></pre></div><p>å¦‚æœä½ ä¸æƒ³æŠŠè¿æ¥ä¿¡æ¯å†™æ­»åœ¨ <code>alembic.ini</code>ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œç„¶ååœ¨ <code>env.py</code> é‡ŒåŠ¨æ€è¯»å–ï¼ˆè¿›é˜¶ç”¨æ³•ï¼Œæœ¬æ–‡å…ˆä¸å±•å¼€ï¼‰ã€‚</p>
<h4 id="2-ç»‘å®š-target_metadata">2ï¸âƒ£ ç»‘å®š <code>target_metadata</code><a hidden class="anchor" aria-hidden="true" href="#2-ç»‘å®š-target_metadata">#</a></h4>
<p>å‡è®¾ä½ åœ¨ <code>models.py</code> ä¸­è¿™æ ·å®šä¹‰æ¨¡å‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># models.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy.orm <span style="color:#f92672">import</span> DeclarativeBase, Mapped, mapped_column
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> String, Integer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Base</span>(DeclarativeBase):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(Base):
</span></span><span style="display:flex;"><span>    __tablename__ <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;users&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    id: Mapped[int] <span style="color:#f92672">=</span> mapped_column(primary_key<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    name: Mapped[str] <span style="color:#f92672">=</span> mapped_column(String(<span style="color:#ae81ff">50</span>))
</span></span></code></pre></div><p>åœ¨ <code>alembic/env.py</code> é‡Œå¼•å…¥è¿™ä¸ª <code>Base</code>ï¼Œå¹¶è®¾ç½® <code>target_metadata</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># alembic/env.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> logging.config <span style="color:#f92672">import</span> fileConfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> alembic <span style="color:#f92672">import</span> context
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> engine_from_config, pool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> myapp.models <span style="color:#f92672">import</span> Base  <span style="color:#75715e"># â† å…³é”®ï¼šå¼•å…¥ä½ çš„ Base</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> config<span style="color:#f92672">.</span>config_file_name <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    fileConfig(config<span style="color:#f92672">.</span>config_file_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target_metadata <span style="color:#f92672">=</span> Base<span style="color:#f92672">.</span>metadata  <span style="color:#75715e"># â† å…³é”®ï¼šå‘Šè¯‰ Alembic ä½ çš„æ¨¡å‹å…ƒæ•°æ®</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå½“ä½ ä½¿ç”¨ <code>--autogenerate</code> æ—¶ï¼ŒAlembic å°±ä¼šæ‹¿ <code>Base.metadata</code> é‡Œçš„ç»“æ„ä¸æ•°æ®åº“å½“å‰ç»“æ„åšå¯¹æ¯”ã€‚</p>
<hr>
<h3 id="å››ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬autogenerate">å››ã€ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆAutogenerateï¼‰<a hidden class="anchor" aria-hidden="true" href="#å››ç¬¬ä¸€æ¬¡ç”Ÿæˆè¿ç§»è„šæœ¬autogenerate">#</a></h3>
<p>ç°åœ¨æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰ <code>users</code> è¿™å¼ è¡¨ï¼Œè€Œä½ çš„æ¨¡å‹é‡Œå·²ç»å®šä¹‰äº†å®ƒã€‚<br>
è®© Alembic å¸®æˆ‘ä»¬ç”Ÿæˆåˆ›å»ºè¯¥è¡¨çš„è¿ç§»ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic revision --autogenerate -m <span style="color:#e6db74">&#34;create users table&#34;</span>
</span></span></code></pre></div><p>æ‰§è¡Œåï¼Œä¼šåœ¨ <code>alembic/versions/</code> ä¸‹ç”Ÿæˆä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic/versions/
</span></span><span style="display:flex;"><span>  20251128_123456_create_users_table.py
</span></span></code></pre></div><p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¤§è‡´æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> alembic <span style="color:#f92672">import</span> op
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlalchemy <span style="color:#66d9ef">as</span> sa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>revision <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20251128_123456&#34;</span>
</span></span><span style="display:flex;"><span>down_revision <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>branch_labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>depends_on <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upgrade</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    op<span style="color:#f92672">.</span>create_table(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;users&#34;</span>,
</span></span><span style="display:flex;"><span>        sa<span style="color:#f92672">.</span>Column(<span style="color:#e6db74">&#34;id&#34;</span>, sa<span style="color:#f92672">.</span>Integer(), primary_key<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>),
</span></span><span style="display:flex;"><span>        sa<span style="color:#f92672">.</span>Column(<span style="color:#e6db74">&#34;name&#34;</span>, sa<span style="color:#f92672">.</span>String(length<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>), nullable<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">downgrade</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    op<span style="color:#f92672">.</span>drop_table(<span style="color:#e6db74">&#34;users&#34;</span>)
</span></span></code></pre></div><p>è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦ç†è§£ï¼š</p>
<ul>
<li><code>upgrade()</code>ï¼šå‡çº§æ—¶æ‰§è¡Œï¼Œåˆ›å»º <code>users</code> è¡¨ï¼›</li>
<li><code>downgrade()</code>ï¼šå›æ»šæ—¶æ‰§è¡Œï¼Œåˆ é™¤ <code>users</code> è¡¨ï¼›</li>
<li><code>revision</code> / <code>down_revision</code>ï¼šè¡¨ç¤ºâ€œæˆ‘æ˜¯è°ï¼Œæˆ‘çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬æ˜¯è°â€ï¼Œç”¨æ¥ä¸²æˆä¸€æ¡è¿ç§»é“¾ã€‚</li>
</ul>
<p><strong>éå¸¸é‡è¦ï¼šæ¯æ¬¡ autogenerate ç”Ÿæˆçš„è„šæœ¬ï¼Œéƒ½åº”è¯¥äººå·¥ review ä¸€éï¼Œè€Œä¸æ˜¯ç›²ç›®æ‰§è¡Œã€‚</strong></p>
<hr>
<h3 id="äº”åº”ç”¨è¿ç§»å‡çº§å’Œå›æ»šæ•°æ®åº“">äº”ã€åº”ç”¨è¿ç§»ï¼šå‡çº§å’Œå›æ»šæ•°æ®åº“<a hidden class="anchor" aria-hidden="true" href="#äº”åº”ç”¨è¿ç§»å‡çº§å’Œå›æ»šæ•°æ®åº“">#</a></h3>
<h4 id="1-å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬head">1ï¸âƒ£ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆheadï¼‰<a hidden class="anchor" aria-hidden="true" href="#1-å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬head">#</a></h4>
<p>æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic upgrade head
</span></span></code></pre></div><p>Alembic ä¼šï¼š</p>
<ul>
<li>è¿æ¥åˆ°ä½ é…ç½®çš„æ•°æ®åº“ï¼›</li>
<li>åœ¨åº“é‡Œåˆ›å»ºä¸€ä¸ªåä¸º <code>alembic_version</code> çš„è¡¨ï¼Œè®°å½•å½“å‰ç‰ˆæœ¬å·ï¼›</li>
<li>æ‰§è¡Œ <code>upgrade()</code>ï¼Œåˆ›å»º <code>users</code> è¡¨ã€‚</li>
</ul>
<p>æ­¤æ—¶ä½ å¯ä»¥ç›´æ¥è¿æ¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹è¡¨ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>
<h4 id="2-å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬">2ï¸âƒ£ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬<a hidden class="anchor" aria-hidden="true" href="#2-å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬">#</a></h4>
<p>å¦‚æœä½ æƒ³æ’¤é”€è¿™æ¬¡è¿ç§»ï¼Œåªè¦ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic downgrade -1
</span></span></code></pre></div><p>Alembic ä¼šæ‰¾åˆ°â€œä¸Šä¸€ä¸ªç‰ˆæœ¬â€ï¼Œæ‰§è¡Œå½“å‰è„šæœ¬çš„ <code>downgrade()</code>ï¼ŒæŠŠ <code>users</code> è¡¨åˆ æ‰ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå›åˆ°æŸä¸ªå…·ä½“ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic downgrade 20251128_123456
</span></span></code></pre></div><p>å‡çº§åŒç†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic upgrade 20251128_123456
</span></span></code></pre></div><hr>
<h3 id="å…­åç»­è¿­ä»£æ¨¡å‹å˜æ›´--è¿ç§»è„šæœ¬--å‡çº§">å…­ã€åç»­è¿­ä»£ï¼šæ¨¡å‹å˜æ›´ â†’ è¿ç§»è„šæœ¬ â†’ å‡çº§<a hidden class="anchor" aria-hidden="true" href="#å…­åç»­è¿­ä»£æ¨¡å‹å˜æ›´--è¿ç§»è„šæœ¬--å‡çº§">#</a></h3>
<p>åç»­å¼€å‘ä¸­ï¼Œä½ çš„æµç¨‹åº”è¯¥å°½é‡å˜æˆï¼š</p>
<ol>
<li>
<p>ä¿®æ”¹ <code>models.py</code> ä¸­çš„æ¨¡å‹ï¼Œæ¯”å¦‚ç»™ <code>User</code> åŠ ä¸€ä¸ª <code>email</code> å­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(Base):
</span></span><span style="display:flex;"><span>    __tablename__ <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;users&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    id: Mapped[int] <span style="color:#f92672">=</span> mapped_column(primary_key<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    name: Mapped[str] <span style="color:#f92672">=</span> mapped_column(String(<span style="color:#ae81ff">50</span>))
</span></span><span style="display:flex;"><span>    email: Mapped[str] <span style="color:#f92672">=</span> mapped_column(String(<span style="color:#ae81ff">100</span>), nullable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div></li>
<li>
<p>ç”Ÿæˆè¿ç§»è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic revision --autogenerate -m <span style="color:#e6db74">&#34;add email to user&#34;</span>
</span></span></code></pre></div><p>æ‰“å¼€ç”Ÿæˆçš„è„šæœ¬ï¼Œç¡®è®¤å†…å®¹å¤§è‡´æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upgrade</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    op<span style="color:#f92672">.</span>add_column(<span style="color:#e6db74">&#34;users&#34;</span>, sa<span style="color:#f92672">.</span>Column(<span style="color:#e6db74">&#34;email&#34;</span>, sa<span style="color:#f92672">.</span>String(length<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>), nullable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">downgrade</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    op<span style="color:#f92672">.</span>drop_column(<span style="color:#e6db74">&#34;users&#34;</span>, <span style="color:#e6db74">&#34;email&#34;</span>)
</span></span></code></pre></div></li>
<li>
<p>æ‰§è¡Œè¿ç§»ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic upgrade head
</span></span></code></pre></div></li>
<li>
<p>åœ¨ä»£ç ä¸­å¼€å§‹ä½¿ç”¨ <code>User.email</code> å­—æ®µã€‚</p>
</li>
</ol>
<p><strong>å…³é”®åŸåˆ™ï¼šæ°¸è¿œè®© Alembic æˆä¸ºâ€œå”¯ä¸€ä¿®æ”¹æ•°æ®åº“ç»“æ„çš„å…¥å£â€ã€‚</strong></p>
<hr>
<h2 id="-å¯è¿è¡Œç¤ºä¾‹ä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§»">ğŸ§ª å¯è¿è¡Œç¤ºä¾‹ï¼šä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§»<a hidden class="anchor" aria-hidden="true" href="#-å¯è¿è¡Œç¤ºä¾‹ä»é›¶åˆ°ç¬¬ä¸€ä¸ªè¿ç§»">#</a></h2>
<p>ä¸‹é¢æ˜¯ä¸€å¥—ä½ å¯ä»¥å¤åˆ¶åˆ°æœ¬åœ°å°è¯•çš„æœ€å°ç¤ºä¾‹ã€‚</p>
<ol>
<li>
<p>æ–°å»ºé¡¹ç›®ç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir alembic-demo
</span></span><span style="display:flex;"><span>cd alembic-demo
</span></span><span style="display:flex;"><span>python -m venv .venv
</span></span><span style="display:flex;"><span>source .venv/bin/activate  <span style="color:#75715e"># Windows ä½¿ç”¨ .venv\Scripts\activate</span>
</span></span><span style="display:flex;"><span>pip install sqlalchemy alembic pymysql
</span></span></code></pre></div></li>
<li>
<p>åˆ›å»º <code>models.py</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># models.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy.orm <span style="color:#f92672">import</span> DeclarativeBase, Mapped, mapped_column
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> String, Integer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Base</span>(DeclarativeBase):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(Base):
</span></span><span style="display:flex;"><span>    __tablename__ <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;users&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    id: Mapped[int] <span style="color:#f92672">=</span> mapped_column(Integer, primary_key<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    name: Mapped[str] <span style="color:#f92672">=</span> mapped_column(String(<span style="color:#ae81ff">50</span>))
</span></span></code></pre></div></li>
<li>
<p>åˆå§‹åŒ– Alembicï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic init alembic
</span></span></code></pre></div></li>
<li>
<p>ä¿®æ”¹ <code>alembic.ini</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">sqlalchemy.url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">mysql+pymysql://user:password@127.0.0.1:3306/alembic_demo</span>
</span></span></code></pre></div></li>
</ol>
<p>ï¼ˆæå‰åœ¨æ•°æ®åº“ä¸­å»ºå¥½ <code>alembic_demo</code> è¿™ä¸ªåº“ã€‚ï¼‰</p>
<ol start="5">
<li>
<p>ä¿®æ”¹ <code>alembic/env.py</code>ï¼Œå¼•å…¥ <code>Base</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> myproject.models <span style="color:#f92672">import</span> Base  <span style="color:#75715e"># æŒ‰ä½ çš„çœŸå®åŒ…åä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target_metadata <span style="color:#f92672">=</span> Base<span style="color:#f92672">.</span>metadata
</span></span></code></pre></div></li>
<li>
<p>ç”Ÿæˆå¹¶åº”ç”¨è¿ç§»ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alembic revision --autogenerate -m <span style="color:#e6db74">&#34;create users table&#34;</span>
</span></span><span style="display:flex;"><span>alembic upgrade head
</span></span></code></pre></div></li>
</ol>
<p>å®Œæˆåï¼Œä½ çš„æ•°æ®åº“ä¸­å°±ä¼šå‡ºç° <code>users</code> è¡¨å’Œ <code>alembic_version</code> è¡¨ã€‚</p>
<hr>
<h2 id="-è§£é‡Šä¸åŸç†alembic-åœ¨èƒŒååšäº†ä»€ä¹ˆ">âš™ï¸ è§£é‡Šä¸åŸç†ï¼šAlembic åœ¨èƒŒååšäº†ä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-è§£é‡Šä¸åŸç†alembic-åœ¨èƒŒååšäº†ä»€ä¹ˆ">#</a></h2>
<p>ç®€å•ç†è§£ Alembic çš„å†…éƒ¨æµç¨‹ï¼š</p>
<ol>
<li>
<p><strong>ç‰ˆæœ¬ç®¡ç†ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªè¿ç§»è„šæœ¬éƒ½æœ‰è‡ªå·±çš„ <code>revision</code> å’Œ <code>down_revision</code>ï¼›</li>
<li>æ•°æ®åº“é‡Œæœ‰ä¸€å¼  <code>alembic_version</code> è¡¨åªå­˜ä¸€ä¸ªå­—æ®µï¼šå½“å‰ç‰ˆæœ¬å·ï¼›</li>
<li>å‡çº§æ—¶ï¼šæ ¹æ®å½“å‰ç‰ˆæœ¬ â†’ æ‰¾åˆ°ç›®æ ‡ç‰ˆæœ¬ â†’ ä¾åºæ‰§è¡Œ <code>upgrade()</code>ï¼›</li>
<li>å›æ»šæ—¶ï¼šæŒ‰åæ–¹å‘æ‰§è¡Œ <code>downgrade()</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>è‡ªåŠ¨å¯¹æ¯”ï¼ˆautogenerateï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</strong></p>
<ul>
<li>Alembic ç”¨ <code>target_metadata</code> ä»£è¡¨â€œæ¨¡å‹ä¸­çš„ç»“æ„â€ï¼›</li>
<li>è¿æ¥æ•°æ®åº“ï¼Œè¯»å–çœŸå®è¡¨ç»“æ„ï¼›</li>
<li>å¯¹æ¯”ä¸¤è€…çš„å·®å¼‚ï¼Œç”Ÿæˆå¯¹åº”çš„ <code>op.create_table</code> / <code>op.add_column</code> ç­‰æ“ä½œï¼›</li>
<li>æŠŠè¿™äº›æ“ä½œå†™å…¥ <code>versions/*.py</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆå¿…é¡»äººå·¥ review è„šæœ¬ï¼š</strong></p>
<ul>
<li>æŸäº›ç±»å‹ï¼ˆå¦‚ <code>Enum</code>ã€<code>server_default</code>ï¼‰åœ¨ä¸åŒæ•°æ®åº“æ–¹è¨€ä¸‹è¡¨ç°ä¸åŒï¼›</li>
<li>æœªæ¥ä½ å¯èƒ½ä¼šåŠ ä¸Šâ€œæ•°æ®è¿ç§»â€é€»è¾‘ï¼Œåªé è‡ªåŠ¨ç”Ÿæˆä¸å¤Ÿï¼›</li>
<li>è‡ªåŠ¨ç”Ÿæˆä¸äº†â€œä¸šåŠ¡æ„å›¾â€ï¼Œä¾‹å¦‚ï¼šç»™æ–°åˆ—å¡«è¡¥é»˜è®¤å€¼ã€è¿ç§»æ—§å­—æ®µçš„æ•°æ®ç­‰ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="-å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹">âš ï¸ å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹<a hidden class="anchor" aria-hidden="true" href="#-å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹">#</a></h2>
<table>
  <thead>
      <tr>
          <th>é—®é¢˜ / åœºæ™¯</th>
          <th>å»ºè®®åšæ³•</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>alembic revision --autogenerate</code> ä¸ç”Ÿæˆä»»ä½•å†…å®¹</td>
          <td>æ£€æŸ¥ <code>env.py</code> æ˜¯å¦æ­£ç¡®è®¾ç½® <code>target_metadata</code>ï¼Œä»¥åŠæ¨¡å‹æ˜¯å¦çœŸçš„å˜æ›´</td>
      </tr>
      <tr>
          <td>ç”Ÿæˆçš„è„šæœ¬ä¸çœŸå®æœŸæœ›ä¸ä¸€è‡´</td>
          <td>æ‰‹åŠ¨ç¼–è¾‘ <code>versions/*.py</code> ä¸­çš„ <code>upgrade()</code> / <code>downgrade()</code></td>
      </tr>
      <tr>
          <td>å¤šäººå¼€å‘æ—¶ç‰ˆæœ¬å·å†²çª</td>
          <td>å°½é‡ä¿æŒä¸€ä¸ªäººè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯çš„è¿ç§»ï¼Œå¹¶åŠæ—¶åˆå¹¶ï¼›å¿…è¦æ—¶æ‰‹å·¥è°ƒæ•´ <code>down_revision</code> å…³ç³»</td>
      </tr>
      <tr>
          <td>æƒ³é‡å»ºä¸€ä»½â€œå¹²å‡€â€çš„è¿ç§»é“¾</td>
          <td>åœ¨æ–°å»ºæ•°æ®åº“ç¯å¢ƒæ—¶å¯ä»¥åˆå¹¶å†å²è¿ç§»ï¼›å¯¹å·²æœ‰ç”Ÿäº§ç¯å¢ƒè¯·æ…é‡ï¼Œé€šå¸¸åªåšè¿½åŠ ä¸åšé‡æ’</td>
      </tr>
      <tr>
          <td>ç”Ÿäº§ç¯å¢ƒå®³æ€•ç›´æ¥æ‰§è¡Œè¿ç§»</td>
          <td>å…ˆåœ¨æµ‹è¯• / staging ç¯å¢ƒå®Œæ•´è·‘ä¸€éè¿ç§»ï¼Œå†ä¸Šçº¿ï¼›å¿…è¦æ—¶å¯¼å‡º SQL åšäººå·¥å®¡æ ¸</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-æœ€ä½³å®è·µä¸å»ºè®®">ğŸŒŸ æœ€ä½³å®è·µä¸å»ºè®®<a hidden class="anchor" aria-hidden="true" href="#-æœ€ä½³å®è·µä¸å»ºè®®">#</a></h2>
<ol>
<li><strong>æ°¸è¿œä¸è¦ç›´æ¥åœ¨æ•°æ®åº“é‡Œæ‰‹æ”¹ç»“æ„</strong>ï¼Œæ‰€æœ‰å˜æ›´å°½é‡é€šè¿‡ Alembic ç®¡ç†ã€‚</li>
<li>æ¯æ¬¡è¿è¡Œ <code>--autogenerate</code> åï¼Œéƒ½è¦æ‰“å¼€ç”Ÿæˆçš„è„šæœ¬ <strong>è®¤çœŸçœ‹ä¸€é</strong>ã€‚</li>
<li>æŠŠ <code>alembic.ini</code>ã€<code>alembic/</code>ã€<code>versions/</code> å…¨éƒ¨æäº¤åˆ° Git ä¸­ï¼Œä¿è¯å›¢é˜Ÿå…±äº«åŒä¸€å¥—å†å²ã€‚</li>
<li>åœ¨ CI ä¸­åŠ ä¸€æ¡â€œè¿ç§»æ£€æŸ¥â€ï¼šæ‹‰èµ·ä¸€ä¸ªæµ‹è¯•åº“ï¼Œè·‘ä¸€é <code>alembic upgrade head</code> ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œã€‚</li>
<li>å¯¹ç”Ÿäº§æ•°æ®åº“æ‰§è¡Œè¿ç§»å‰ï¼Œä¸€å®šè¦ï¼š
<ul>
<li>æœ‰æœ€è¿‘çš„å¤‡ä»½ï¼›</li>
<li>åœ¨æµ‹è¯•ç¯å¢ƒæ¼”ç»ƒè¿‡ä¸€æ¬¡ï¼›</li>
<li>æœ€å¥½æœ‰å›æ»šæ–¹æ¡ˆï¼ˆdowngrade æˆ–æ‰‹å·¥ SQLï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="-å°ç»“--ç»“è®º">ğŸ“š å°ç»“ / ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#-å°ç»“--ç»“è®º">#</a></h2>
<p>è¿™ç¯‡å…¥é—¨æ–‡ç« å¸¦ä½ èµ°å®Œäº† Alembic çš„æœ€å°é—­ç¯ï¼š</p>
<ul>
<li>å®‰è£… Alembicï¼Œå¹¶åœ¨é¡¹ç›®ä¸­åˆå§‹åŒ–ï¼›</li>
<li>é€šè¿‡ <code>env.py</code> ç»‘å®š SQLAlchemy æ¨¡å‹ï¼ˆ<code>target_metadata</code>ï¼‰ï¼›</li>
<li>ç”¨ <code>revision --autogenerate</code> ç”Ÿæˆè¿ç§»è„šæœ¬ï¼›</li>
<li>ç”¨ <code>upgrade</code> / <code>downgrade</code> ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬ï¼›</li>
<li>å½¢æˆâ€œ<strong>æ¨¡å‹å˜æ›´ â†’ ç”Ÿæˆè¿ç§» â†’ æ‰§è¡Œè¿ç§»</strong>â€çš„æ ‡å‡†æµç¨‹ã€‚</li>
</ul>
<p>ç†è§£äº†è¿™äº›ï¼Œä½ å·²ç»å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œæ”¾å¿ƒä½¿ç”¨ Alembic äº†ã€‚<br>
åç»­ä½ è¿˜å¯ä»¥ç»§ç»­å­¦ä¹ ï¼š</p>
<ul>
<li>å¤šç¯å¢ƒé…ç½®ï¼ˆå¼€å‘ / æµ‹è¯• / ç”Ÿäº§ä¸åŒæ•°æ®åº“ï¼‰ï¼›</li>
<li>æ•°æ®è¿ç§»ã€æ‰¹é‡æ›´æ–°ï¼›</li>
<li>é«˜çº§å¹²é¢„ï¼ˆ<code>include_object</code>ã€<code>process_revision_directives</code> ç­‰ï¼‰â€”â€” å¯ä»¥ç»“åˆæˆ‘å†™çš„å¦ä¸€ç¯‡ã€Šå¦‚ä½•å¹²é¢„ Alembicï¼šä»è‡ªåŠ¨ç”Ÿæˆåˆ°ç²¾ç»†æ§åˆ¶ã€‹ä¸€èµ·çœ‹ã€‚</li>
</ul>
<hr>
<h2 id="-å‚è€ƒä¸å»¶ä¼¸é˜…è¯»">ğŸ”— å‚è€ƒä¸å»¶ä¼¸é˜…è¯»<a hidden class="anchor" aria-hidden="true" href="#-å‚è€ƒä¸å»¶ä¼¸é˜…è¯»">#</a></h2>
<ul>
<li>Alembic å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://alembic.sqlalchemy.org/">https://alembic.sqlalchemy.org/</a></li>
<li>SQLAlchemy å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.sqlalchemy.org/">https://docs.sqlalchemy.org/</a></li>
<li>â€œEnvironment &amp; Migration Contextâ€ï¼ˆå®˜æ–¹æ–‡æ¡£ä¸­å…³äº env.py çš„ç« èŠ‚ï¼‰</li>
<li>ã€Šå¦‚ä½•å¹²é¢„ Alembicï¼šä»è‡ªåŠ¨ç”Ÿæˆåˆ°ç²¾ç»†æ§åˆ¶ã€‹ï¼ˆåŒä¸€ä¸“æ çš„è¿›é˜¶ç¯‡ï¼‰</li>
</ul>
<hr>
<h2 id="-å…ƒä¿¡æ¯">ğŸ·ï¸ å…ƒä¿¡æ¯<a hidden class="anchor" aria-hidden="true" href="#-å…ƒä¿¡æ¯">#</a></h2>
<ul>
<li><strong>é˜…è¯»æ—¶é•¿</strong>ï¼š8â€“12 åˆ†é’Ÿ</li>
<li><strong>æ ‡ç­¾</strong>ï¼š<code>Python</code>ï¼Œ<code>Alembic</code>ï¼Œ<code>SQLAlchemy</code>ï¼Œ<code>æ•°æ®åº“è¿ç§»</code>ï¼Œ<code>åç«¯å…¥é—¨</code></li>
<li><strong>SEO å…³é”®è¯</strong>ï¼šAlembic å…¥é—¨ï¼ŒSQLAlchemy æ•°æ®åº“è¿ç§»ï¼Œalembic tutorialï¼ŒPython æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†</li>
<li><strong>å…ƒæè¿°</strong>ï¼šè¿™æ˜¯ä¸€ç¯‡é¢å‘åˆå­¦è€…çš„ Alembic å…¥é—¨æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ ä»é›¶é…ç½® Alembicï¼Œä¸ SQLAlchemy æ¨¡å‹è”åŠ¨ï¼Œå®Œæˆæ•°æ®åº“è¿ç§»çš„ç”Ÿæˆã€å‡çº§ä¸å›æ»šã€‚</li>
</ul>
<hr>
<h2 id="-è¡ŒåŠ¨å·å¬cta">ğŸš€ è¡ŒåŠ¨å·å¬ï¼ˆCTAï¼‰<a hidden class="anchor" aria-hidden="true" href="#-è¡ŒåŠ¨å·å¬cta">#</a></h2>
<p>ç°åœ¨å°±å¯ä»¥åœ¨ä½ çš„é¡¹ç›®é‡Œè¯•è¯•ï¼š</p>
<ol>
<li>æŠŠç°æœ‰ SQLAlchemy æ¨¡å‹ä¸ Alembic è¿æ¥èµ·æ¥ï¼›</li>
<li>ç”¨ <code>alembic revision --autogenerate</code> ç”Ÿæˆç¬¬ä¸€ä»½è¿ç§»è„šæœ¬ï¼›</li>
<li>åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªå¹²å‡€æ•°æ®åº“ï¼Œè·‘ä¸€é <code>alembic upgrade head</code>ï¼Œæ„Ÿå—â€œä»æ— åˆ°æœ‰å»ºå‡ºå…¨éƒ¨è¡¨â€çš„è¿‡ç¨‹ã€‚</li>
</ol>
<p>å¦‚æœä½ åœ¨æ¥å…¥ Alembic çš„è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼ˆé…ç½®ã€å‘½ä»¤ã€è„šæœ¬å†²çªç­‰ï¼‰ï¼Œå¯ä»¥æŠŠæŠ¥é”™å’Œ <code>env.py</code> ç‰‡æ®µè´´å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¡æ¡ä¸€èµ·æ‹†ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/dev/python/permission-architecture-aggregate-repository/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>ä»è¡¨ç»“æ„åˆ°é¢†åŸŸæ¨¡å‹ï¼šç”¨èšåˆä»“å‚¨è®¾è®¡æƒé™ç³»ç»Ÿ</span>
  </a>
  <a class="next" href="http://localhost:1313/dev/python/alembic-autogenerate-to-manual-control/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>å¦‚ä½•å¹²é¢„ Alembicï¼šä»è‡ªåŠ¨ç”Ÿæˆåˆ°ç²¾ç»†æ§åˆ¶</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on x"
            href="https://x.com/intent/tweet/?text=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb&amp;url=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f&amp;title=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb&amp;summary=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb&amp;source=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f&title=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on whatsapp"
            href="https://api.whatsapp.com/send?text=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb%20-%20http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on telegram"
            href="https://telegram.me/share/url?text=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb&amp;url=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Alembic å…¥é—¨ï¼šç¬¬ä¸€æ¬¡ç”¨ SQLAlchemy åšæ•°æ®åº“è¿ç§» on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Alembic%20%e5%85%a5%e9%97%a8%ef%bc%9a%e7%ac%ac%e4%b8%80%e6%ac%a1%e7%94%a8%20SQLAlchemy%20%e5%81%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%81%e7%a7%bb&u=http%3a%2f%2flocalhost%3a1313%2fdev%2fpython%2falembic-intro-sqlalchemy-migrations%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Jeanphilo Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

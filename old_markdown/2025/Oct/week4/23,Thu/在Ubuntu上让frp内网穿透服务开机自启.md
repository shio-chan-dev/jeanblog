# ğŸš€ åœ¨ Ubuntu ä¸Šè®© frp å†…ç½‘ç©¿é€æœåŠ¡å¼€æœºè‡ªå¯ï¼šå®Œæ•´æŒ‡å—

**å‰¯æ ‡é¢˜ / æ‘˜è¦**
é€šè¿‡ systemd å°† frpï¼ˆFast Reverse Proxyï¼‰è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå®ç°ç¨³å®šã€å®‰å…¨ã€å¯ç›‘æ§çš„å¼€æœºè‡ªåŠ¨å¯åŠ¨æ–¹æ¡ˆï¼Œé¿å…æ¯æ¬¡æ‰‹åŠ¨è¿è¡Œã€‚

**é˜…è¯»æ—¶é•¿**ï¼š8 åˆ†é’Ÿ
**æ ‡ç­¾**ï¼šfrpã€å†…ç½‘ç©¿é€ã€systemdã€è‡ªå¯ã€Linuxã€Ubuntu
**SEO å…³é”®è¯**ï¼šfrp å¼€æœºè‡ªå¯ã€Ubuntu frp é…ç½®ã€frpc systemdã€frps æœåŠ¡ç«¯å¯åŠ¨ã€å†…ç½‘ç©¿é€é…ç½®
**å…ƒæè¿°**ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ åœ¨ Ubuntu ä¸Šä½¿ç”¨ systemd å°† frpï¼ˆfrpc / frpsï¼‰è®¾ç½®ä¸ºå¼€æœºè‡ªå¯æœåŠ¡ï¼Œé™„é…ç½®æ–‡ä»¶æ¨¡æ¿ä¸å¸¸è§é—®é¢˜æ’æŸ¥ã€‚

---

## ğŸ¯ ç›®æ ‡è¯»è€…

é€‚åˆï¼š

* æƒ³åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² frps çš„å¼€å‘è€…
* æƒ³è®©å®¶ä¸­/åŠå…¬å†…ç½‘æœºå™¨é•¿æœŸç¨³å®šç©¿é€çš„ä¸­çº§ Linux ç”¨æˆ·
* DevOps / è‡ªå»ºæœåŠ¡çˆ±å¥½è€…

---

## ğŸ§© èƒŒæ™¯ä¸åŠ¨æœº

è®¸å¤šå¼€å‘è€…ä½¿ç”¨ **frp** å®ç°å†…ç½‘ç©¿é€ï¼Œè®©å†…ç½‘æœåŠ¡ï¼ˆå¦‚ SSHã€Webã€NASï¼‰å¯ä»¥å®‰å…¨åœ°ä»å¤–éƒ¨è®¿é—®ã€‚
é—®é¢˜æ˜¯ï¼šæ‰‹åŠ¨è¿è¡Œ `./frpc -c frpc.ini` æ—¢éº»çƒ¦åˆä¸ç¨³å®šï¼Œæœºå™¨é‡å¯åå®¹æ˜“å¿˜è®°å¯åŠ¨ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ **systemd æœåŠ¡** å®ç°â€œ**è‡ªåŠ¨éšç³»ç»Ÿå¯åŠ¨ + å¤±è´¥è‡ªåŠ¨é‡å¯ + é›†ä¸­æ—¥å¿—ç®¡ç†**â€çš„æ•ˆæœã€‚

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

* **frps / frpc**ï¼šfrp çš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å¯æ‰§è¡Œç¨‹åºã€‚
* **systemd**ï¼šç°ä»£ Linux ç³»ç»Ÿçš„æœåŠ¡ç®¡ç†å™¨ï¼Œç”¨äºå®šä¹‰å’Œæ§åˆ¶åå°æœåŠ¡ã€‚
* **unit æ–‡ä»¶**ï¼šå®šä¹‰æœåŠ¡çš„é…ç½®ï¼ˆå¦‚å¯åŠ¨å‘½ä»¤ã€ä¾èµ–ã€é‡å¯ç­–ç•¥ï¼‰ã€‚

---

## ğŸ› ï¸ å®è·µæ­¥éª¤æŒ‡å—

### 1ï¸âƒ£ å®‰è£…ä¸å‡†å¤‡

å°†äºŒè¿›åˆ¶æ–‡ä»¶ä¸é…ç½®æ–‡ä»¶æ”¾å…¥ç³»ç»Ÿè·¯å¾„ï¼š

```bash
sudo mv frpc /usr/local/bin/
sudo chmod +x /usr/local/bin/frpc
sudo mkdir -p /etc/frp
sudo mv frpc.ini /etc/frp/frpc.ini
```

> ğŸ’¡ æç¤ºï¼šæœåŠ¡ç«¯ä½¿ç”¨ frps æ—¶åŒç†ï¼Œåªéœ€æ¢æˆ `frps` å’Œ `frps.ini`ã€‚

---

### 2ï¸âƒ£ ï¼ˆå¯é€‰ï¼‰åˆ›å»ºä¸“ç”¨è¿è¡Œç”¨æˆ·

å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸å»ºè®®ä½¿ç”¨ rootï¼š

```bash
sudo useradd --system --no-create-home --shell /sbin/nologin frp
sudo chown -R frp:frp /etc/frp
```

---

### 3ï¸âƒ£ åˆ›å»º systemd Unit æ–‡ä»¶

æ–°å»º `/etc/systemd/system/frpc.service`ï¼š

```ini
[Unit]
Description=frp client service
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=frp
Group=frp
ExecStart=/usr/local/bin/frpc -c /etc/frp/frpc.ini
Restart=on-failure
RestartSec=5
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
```

---

### 4ï¸âƒ£ å¯åŠ¨ä¸å¯ç”¨è‡ªå¯

```bash
sudo systemctl daemon-reload
sudo systemctl start frpc
sudo systemctl enable frpc
```

---

### 5ï¸âƒ£ æ£€æŸ¥çŠ¶æ€ä¸æ—¥å¿—

```bash
sudo systemctl status frpc
sudo journalctl -u frpc -f
```

æ—¥å¿—é›†ä¸­åœ¨ systemd æ—¥å¿—ä¸­ï¼Œæ–¹ä¾¿æ’é”™ä¸ç›‘æ§ã€‚

---

## ğŸ§  åŸç†ä¸è§£é‡Š

`systemd` åœ¨å¯åŠ¨é˜¶æ®µä¼šæ ¹æ® `WantedBy=multi-user.target` è‡ªåŠ¨åŠ è½½è¯¥æœåŠ¡ã€‚
`After=network-online.target` ç¡®ä¿ç½‘ç»œå¯ç”¨åå†å¯åŠ¨ï¼Œé¿å…è¿æ¥å¤±è´¥ã€‚
`Restart=on-failure` åˆ™ä¿è¯ frpc å¼‚å¸¸é€€å‡ºåèƒ½è‡ªåŠ¨é‡å¯ï¼Œæé«˜ç¨³å®šæ€§ã€‚

ç›¸æ¯” `@reboot` çš„ cron æ–¹æ¡ˆï¼Œsystemd æä¾›äº†æ›´ç²¾ç»†çš„ä¾èµ–ç®¡ç†ã€é‡å¯ç­–ç•¥ä¸ç»Ÿä¸€æ—¥å¿—ã€‚

---

## âš ï¸ å¸¸è§é—®é¢˜ä¸é™·é˜±

| é—®é¢˜       | åŸå›                | è§£å†³æ–¹æ¡ˆ                                        |
| -------- | ---------------- | ------------------------------------------- |
| æœåŠ¡å¯åŠ¨å¤±è´¥   | é…ç½®æ–‡ä»¶æƒé™é”™è¯¯         | ç¡®ä¿ `/etc/frp/frpc.ini` å¯è¢« frp ç”¨æˆ·è¯»å–          |
| ç½‘ç»œæœªå°±ç»ª    | systemd ä¾èµ–ä¸å®Œæ•´    | ç¡®ä¿å¯ç”¨ `systemd-networkd-wait-online.service` |
| frp æ— æ³•è¿æ¥ | é˜²ç«å¢™æˆ–å®‰å…¨ç»„æœªå¼€æ”¾ç«¯å£     | ç¡®è®¤ TCP/UDP ç«¯å£æ”¾é€š                             |
| æœåŠ¡æ— æ³•è‡ªå¯   | å¿˜è®°æ‰§è¡Œ `enable` å‘½ä»¤ | `sudo systemctl enable frpc`                |

---

## âœ… æœ€ä½³å®è·µä¸å»ºè®®

* ä½¿ç”¨ **é root ç”¨æˆ·** è¿è¡ŒæœåŠ¡ï¼Œæå‡å®‰å…¨æ€§ã€‚
* å°†æ—¥å¿—é‡å®šå‘æˆ–æ”¶é›†åˆ° ELK/Promtail ç­‰ç³»ç»Ÿä¸­ã€‚
* æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯é…ç½®å‡åº”å¼€å¯ token è®¤è¯æˆ– TLSã€‚
* è‹¥éœ€å¤šä¸ª frpc å®ä¾‹ï¼Œå¯ç”¨ `frpc@xxx.service` æ¨¡æ¿æœºåˆ¶ã€‚

---

## ğŸ§¾ å°ç»“

æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ï¼š

1. å®‰è£…ä¸é…ç½® frp
2. åˆ›å»º systemd æœåŠ¡
3. å®ç°è‡ªåŠ¨å¯åŠ¨ä¸è‡ªåŠ¨é‡å¯
4. ç†è§£èƒŒåçš„æœºåˆ¶ä¸å¸¸è§é™·é˜±

æŒæ¡ systemd é…ç½®åï¼Œä½ å¯ä»¥ç”¨ç›¸åŒæ–¹æ³•ç®¡ç†ä»»ä½•è‡ªå®šä¹‰åå°ç¨‹åºã€‚

---

## ğŸ”— å‚è€ƒä¸å»¶ä¼¸é˜…è¯»

* [frp å®˜æ–¹æ–‡æ¡£](https://github.com/fatedier/frp)
* [systemd.service å®˜æ–¹è¯´æ˜](https://www.freedesktop.org/software/systemd/man/systemd.service.html)
* [Ubuntu Server Guide - systemd](https://ubuntu.com/server/docs/service-systemd)

---

## ğŸ’¬ è¡ŒåŠ¨å·å¬

ğŸ‘‰ è¯•è¯•çœ‹ï¼
å°†æœ¬æ–‡çš„ unit æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„æœåŠ¡å™¨ä¸­ï¼Œè¿è¡Œ `sudo systemctl enable --now frpc`ã€‚
å¦‚æœæˆåŠŸå¯åŠ¨ï¼Œè¯·åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ä½ ç”¨ frp å®ç°äº†ä»€ä¹ˆæœ‰è¶£çš„é¡¹ç›®ï¼
ä½ ä¹Ÿå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æœ¬æ–‡å¯¹åº”çš„æ¨¡æ¿ä¸è„šæœ¬ï¼ˆé™„è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼‰ã€‚

